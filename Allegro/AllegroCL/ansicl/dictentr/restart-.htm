<!doctype HTML public "-//W3O//DTD W3 HTML 3.2//EN">
<HTML>
<HEAD>

<!-- 
  Document                : restart_.htm
  representing node       : restart_case  [ID:NO-662]
                 of class : DictEntry  [ID:SC-9]
  Generated by SchemaText : 1.52
  From HSDL source        : ansi cl
  At                      : 09:53:54 23.07.98

  About SchemaText        : http://www.schema.de
-->

<META NAME="GENERATOR" CONTENT="SchemaText 1.40f">
<META NAME="AUTHOR" CONTENT="Franz Inc.">
<META NAME="DATE" CONTENT="23.07.98">
<META NAME="TIME" CONTENT="09:51:09">
<META NAME="VERSION" CONTENT="520">

<TITLE>restart-case</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFFF">

<table border="0" width="100%" cellpadding="1" cellspacing="0">
  <tr>
    <td bgcolor="#00FFFF"><table border="0" cellpadding="5" cellspacing="3">
      <tr>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/contents.htm"><b>ToC</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/introduction.htm"><b>DocOverview</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/cgide.htm"><b>CGDoc</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/release-notes.htm"><b>RelNotes</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/index.htm"><b>Index</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/permuted-index.htm"><b>PermutedIndex</b></a></td>
      </tr>
    </table>
    </td>
    <td align="right"><b>Allegro CL</b>
    </td>
  </tr>
</table>

<A NAME="DictEntry_restart_case_662"></A>
<FONT FACE="ARIAL,GENEVA,HELVETICA">
<A HREF="../ansicl.htm" TARGET="_self"><IMG SRC="../images/a-top12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Home"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>

<A HREF="restart1.htm"><IMG SRC="../images/a-lft12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Previous"></A> 
<A HREF="../section/dictio15.htm" TARGET="_self"><IMG SRC="../images/a-up12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Up"></A> 
<A HREF="restart0.htm"><IMG SRC="../images/a-rgh12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Next"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/tableofc.htm" TARGET="_self"><IMG SRC="../images/toc.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Table of Contents"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/index.htm" TARGET="_self"><IMG SRC="../images/i16.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Index"></A>
<HR NOSHADE>
<TABLE WIDTH="90%"><TR>
<TD WIDTH=5%>&nbsp;</TD>
<TD WIDTH=95%>
<FONT SIZE=-2>
<A HREF="../ansicl.htm"> ANSI Common Lisp</A>&nbsp;&nbsp;<IMG SRC="../images/a-rgh6b.gif" BORDER=0 WIDTH=6 HEIGHT=6>&nbsp;<A HREF="../chapter/conditio.htm">9 Conditions</A>&nbsp;&nbsp;<IMG SRC="../images/a-rgh6b.gif" BORDER=0 WIDTH=6 HEIGHT=6>&nbsp;<A HREF="../section/dictio15.htm">9.2 Dictionary of Conditions</A>

</FONT>
<P ID="2">
<TABLE BORDER=0 WIDTH="100%">
<TR>
<TD><FONT SIZE="+2">9.2.37  restart-case</FONT></TD>
<TD ALIGN=RIGHT><FONT SIZE="+1"><I>Macro</I></FONT></TD>
</TR></TABLE>
<DL>


<P ID="3">


<P ID="4">
<DT><B>Syntax:</B><DD>

<TABLE BORDER=0>
<TR><TD><B>restart-case</B></TD><TD><I>restartable-form</I> <TT>{</TT><IMG SRC="../images/downarr.gif" BORDER=0 WIDTH=13 HEIGHT=11>clause<TT>}</TT>
		  <IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> {<I>result</I>}*</TD></TABLE>
<P ID="5">

<TABLE BORDER=0>
<TR><TD>
clause::= </TD><TD>( case-name lambda-list</TD></TR>
<TR><TD></TD><TD>[[<TT>:interactive</TT> <I>interactive-expression</I> |
		      	      <TT>:report</TT> <I>report-expression</I> |
			      <TT>:test</TT> <I>test-expression</I>]]</TD></TR>
<TR><TD></TD><TD>{<I>declaration</I>}* 
{<I>form</I>}*)<P ID="6"></TD></TR>
</TABLE>


<P ID="7">
<DT><B>Arguments and Values:</B><DD>

<I>restartable-form</I> - a <I><A HREF="../glossary/f.htm#form">form</A></I>.

<P ID="8">
<I>case-name</I> - a <I><A HREF="../glossary/s.htm#symbol">symbol</A></I> or <A HREF="nil.htm"><B>nil</B></A>.

<P ID="9">
<I>lambda-list</I> - an <I><A HREF="../glossary/o.htm#ordinarylambdalist">ordinary lambda list</A></I>.

<P ID="10">
<I>interactive-expression</I> - a <I><A HREF="../glossary/s.htm#symbol">symbol</A></I> or a <I><A HREF="../glossary/l.htm#lambdaexpression">lambda expression</A></I>.

<P ID="11">
<I>report-expression</I> - a <I><A HREF="../glossary/s.htm#string">string</A></I>,
			     a <I><A HREF="../glossary/s.htm#symbol">symbol</A></I>,
			     or a <I><A HREF="../glossary/l.htm#lambdaexpression">lambda expression</A></I>.                                 

<P ID="12">
<I>test-expression</I> - a <I><A HREF="../glossary/s.htm#symbol">symbol</A></I> or a <I><A HREF="../glossary/l.htm#lambdaexpression">lambda expression</A></I>.

<P ID="13">
<I>declaration</I> - a <A HREF="declare.htm"><B>declare</B></A> <I><A HREF="../glossary/e.htm#expression">expression</A></I>; not evaluated.

<P ID="14">
<I>form</I> - a <I><A HREF="../glossary/f.htm#form">form</A></I>.

<P ID="15">
<I>results</I> - the <I><A HREF="../glossary/v.htm#value">values</A></I> resulting from the <I><A HREF="../glossary/e.htm#evaluation">evaluation</A></I>
		   of <I>restartable-form</I>, 
		  or the <I><A HREF="../glossary/v.htm#value">values</A></I> returned by the last <I>form</I>
		   executed in a chosen <I>clause</I>,
		  or <A HREF="nil.htm"><B>nil</B></A>.

<P ID="16">
<DT><B>Description:</B><DD>

<A HREF="#DictEntry_restart_case_662"><B>restart-case</B></A> evaluates <I>restartable-form</I> in a <I><A HREF="../glossary/d.htm#dynamicenvironment">dynamic environment</A></I>
where the clauses have special meanings as points to which control may be transferred.  
If <I>restartable-form</I> finishes executing and returns any values, 
all values returned are returned by <A HREF="#DictEntry_restart_case_662"><B>restart-case</B></A> and 
processing has completed. While <I>restartable-form</I> is executing, any code may
  transfer control to one of the clauses (see <A HREF="invoke-r.htm"><B>invoke-restart</B></A>).  
If a transfer
  occurs, the forms in the body of that clause is evaluated and any values
  returned by the last such form are returned by 
<A HREF="#DictEntry_restart_case_662"><B>restart-case</B></A>.
In this case, the 
dynamic state is unwound appropriately (so that the restarts established
around the <I>restartable-form</I> are no longer active) prior to execution of the
clause.

<P ID="17">
  If there are no <I>forms</I> 
in a selected clause, <A HREF="#DictEntry_restart_case_662"><B>restart-case</B></A> returns <A HREF="nil.htm"><B>nil</B></A>.

<P ID="18">
If <I>case-name</I> is a <I><A HREF="../glossary/s.htm#symbol">symbol</A></I>, it names this restart.

<P ID="19">
It is possible to have more than one clause use the same <I>case-name</I>.
In this case, the first clause with that name is found by <A HREF="find-res.htm"><B>find-restart</B></A>.  
The other clauses are accessible using <A HREF="compute-.htm"><B>compute-restarts</B></A>.

<P ID="20">
Each <I>arglist</I> is an <I><A HREF="../glossary/o.htm#ordinarylambdalist">ordinary lambda list</A></I> to be bound during the 
execution of its corresponding <I>forms</I>.  These parameters are used 
by the <A HREF="#DictEntry_restart_case_662"><B>restart-case</B></A> clause to receive any necessary data from a call
to <A HREF="invoke-r.htm"><B>invoke-restart</B></A>.

<P ID="21">
By default, <A HREF="invoke-0.htm"><B>invoke-restart-interactively</B></A> passes no arguments and
all arguments must be optional in order to accomodate interactive
restarting.  However, the arguments need not be optional if the
<TT>:interactive</TT> 
keyword has been used to inform <A HREF="invoke-0.htm"><B>invoke-restart-interactively</B></A>
  about how to compute a proper argument list.

<P ID="22">
<I>Keyword</I> options have the following meaning.
<UL>
<LI ID="23"><TT>:interactive</TT>

<P ID="24">
The <I>value</I> supplied by <TT>:interactive <I>value</I></TT>
must be a suitable argument to <A HREF="function.htm"><B>function</B></A>. 
<TT>(function <I>value</I>)</TT> is evaluated in the current lexical
    environment.  It should return a <I><A HREF="../glossary/f.htm#function">function</A></I> of no arguments which 
    returns arguments to be used by 
<A HREF="invoke-0.htm"><B>invoke-restart-interactively</B></A> when it is invoked.
<A HREF="invoke-0.htm"><B>invoke-restart-interactively</B></A> 
is called in the dynamic
    environment available prior to any restart attempt, and uses 
<I>query I/O</I> for user interaction.

<P ID="25">
    If a restart is invoked interactively but no <TT>:interactive</TT> option
    was supplied, the argument list used in the invocation is the empty
    list.

<P ID="26">
<LI ID="27"><TT>:report</TT>

<P ID="28">
If the <I>value</I> supplied by <TT>:report <I>value</I></TT>
is a <I><A HREF="../glossary/l.htm#lambdaexpression">lambda expression</A></I> or a <I><A HREF="../glossary/s.htm#symbol">symbol</A></I>, it 
must be acceptable to <A HREF="function.htm"><B>function</B></A>.
<TT>(function <I>value</I>)</TT> is evaluated in the current lexical
environment.  It should return a <I><A HREF="../glossary/f.htm#function">function</A></I> of one
argument, a <I><A HREF="../glossary/s.htm#stream">stream</A></I>, which prints on the <I><A HREF="../glossary/s.htm#stream">stream</A></I> a 
description of the restart.  This <I><A HREF="../glossary/f.htm#function">function</A></I> is called 
whenever the restart is printed while <A HREF="print-es.htm"><B>*print-escape*</B></A> is <A HREF="nil.htm"><B>nil</B></A>.

<P ID="29">
If <I>value</I> is a <I><A HREF="../glossary/s.htm#string">string</A></I>, it is a shorthand for

<P ID="30">
<PRE ID="31">
 (lambda (stream) (write-string value stream))
</PRE>

<P ID="32">
    If a named restart is asked to report but no report information has been
    supplied, the name of the restart is used in generating default report text.

<P ID="33">
    When <A HREF="print-es.htm"><B>*print-escape*</B></A> is <A HREF="nil.htm"><B>nil</B></A>, the 
printer uses the report information for
    a restart.  For example, a debugger might announce the action of typing
    a "continue" command by:

<P ID="34">
<PRE ID="35">
 (format t "~&~S -- ~A~%" ':continue some-restart)
</PRE>
    which might then display as something like:

<P ID="36">
<PRE ID="37">
 :CONTINUE -- Return to command level
</PRE>

<P ID="38">
The consequences are unspecified if an unnamed restart is specified
but no <TT>:report</TT> option is provided.

<P ID="39">

<LI ID="40"><TT>:test</TT>

<P ID="41">
The <I>value</I> supplied by <TT>:test <I>value</I></TT>
must be a suitable argument to <A HREF="function.htm"><B>function</B></A>. 
<TT>(function <I>value</I>)</TT> is evaluated in the current lexical
    environment.  It should return a <I><A HREF="../glossary/f.htm#function">function</A></I> of one <I><A HREF="../glossary/a.htm#argument">argument</A></I>, the
<I><A HREF="../glossary/c.htm#condition">condition</A></I>, that
returns <I><A HREF="../glossary/t.htm#true">true</A></I> if the restart is to be considered visible.

<P ID="42">
The default for this option is equivalent to <TT>(lambda (c) (declare (ignore c)) t)</TT>.

</UL>

<P ID="43">

If the <I>restartable-form</I> is a <I><A HREF="../glossary/l.htm#list">list</A></I> whose <I><A HREF="../glossary/c.htm#car">car</A></I> is any of
the <I><A HREF="../glossary/s.htm#symbol">symbols</A></I> <A HREF="signal.htm"><B>signal</B></A>, <A HREF="error.htm"><B>error</B></A>, <A HREF="cerror.htm"><B>cerror</B></A>,
or <A HREF="warn.htm"><B>warn</B></A> (or is a <I><A HREF="../glossary/m.htm#macroform">macro form</A></I> which macroexpands into such a
<I><A HREF="../glossary/l.htm#list">list</A></I>), then <A HREF="with-con.htm"><B>with-condition-restarts</B></A> is used implicitly
to associate the indicated <I><A HREF="../glossary/r.htm#restart">restarts</A></I> with the <I><A HREF="../glossary/c.htm#condition">condition</A></I> to be
signaled.


<P ID="44">
<DT><B>Examples:</B><DD>

<PRE ID="45">
 (restart-case
     (handler-bind ((error #'(lambda (c)
                             (declare (ignore condition))
                             (invoke-restart 'my-restart 7))))
       (error "Foo."))
   (my-restart (&optional v) v))
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> 7

 (define-condition food-error (error) ())
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9>  FOOD-ERROR
 (define-condition bad-tasting-sundae (food-error) 
   ((ice-cream :initarg :ice-cream :reader bad-tasting-sundae-ice-cream)
    (sauce :initarg :sauce :reader bad-tasting-sundae-sauce)
    (topping :initarg :topping :reader bad-tasting-sundae-topping))
   (:report (lambda (condition stream)
              (format stream "Bad tasting sundae with ~S, ~S, and ~S"
                      (bad-tasting-sundae-ice-cream condition)
                      (bad-tasting-sundae-sauce condition)
                      (bad-tasting-sundae-topping condition)))))
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9>  BAD-TASTING-SUNDAE
 (defun all-start-with-same-letter (symbol1 symbol2 symbol3)
   (let ((first-letter (char (symbol-name symbol1) 0)))
     (and (eql first-letter (char (symbol-name symbol2) 0))
          (eql first-letter (char (symbol-name symbol3) 0)))))
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9>  ALL-START-WITH-SAME-LETTER
 (defun read-new-value ()
   (format t "Enter a new value: ")
   (multiple-value-list (eval (read))))
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9>  READ-NEW-VALUE
 (defun verify-or-fix-perfect-sundae (ice-cream sauce topping)
   (do ()
      ((all-start-with-same-letter ice-cream sauce topping))
     (restart-case
       (error 'bad-tasting-sundae
              :ice-cream ice-cream
              :sauce sauce
              :topping topping)
       (use-new-ice-cream (new-ice-cream)
         :report "Use a new ice cream."
         :interactive read-new-value  
         (setq ice-cream new-ice-cream))
       (use-new-sauce (new-sauce)
         :report "Use a new sauce."
         :interactive read-new-value
         (setq sauce new-sauce))
       (use-new-topping (new-topping)
         :report "Use a new topping."
         :interactive read-new-value
         (setq topping new-topping))))
   (values ice-cream sauce topping))
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9>  VERIFY-OR-FIX-PERFECT-SUNDAE
 (verify-or-fix-perfect-sundae 'vanilla 'caramel 'cherry)
<IMG SRC="../images/triangle.gif" BORDER=0 WIDTH=10 HEIGHT=9> Error: Bad tasting sundae with VANILLA, CARAMEL, and CHERRY.
<IMG SRC="../images/triangle.gif" BORDER=0 WIDTH=10 HEIGHT=9> To continue, type :CONTINUE followed by an option number:
<IMG SRC="../images/triangle.gif" BORDER=0 WIDTH=10 HEIGHT=9> 1: Use a new ice cream.
<IMG SRC="../images/triangle.gif" BORDER=0 WIDTH=10 HEIGHT=9> 2: Use a new sauce.
<IMG SRC="../images/triangle.gif" BORDER=0 WIDTH=10 HEIGHT=9> 3: Use a new topping.
<IMG SRC="../images/triangle.gif" BORDER=0 WIDTH=10 HEIGHT=9> 4: Return to Lisp Toplevel.
<IMG SRC="../images/triangle.gif" BORDER=0 WIDTH=10 HEIGHT=9> Debug&gt; <U>:continue 1</U>
<IMG SRC="../images/triangle.gif" BORDER=0 WIDTH=10 HEIGHT=9> Use a new ice cream.
<IMG SRC="../images/triangle.gif" BORDER=0 WIDTH=10 HEIGHT=9> Enter a new ice cream: <U>'chocolate</U>
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9>  CHOCOLATE, CARAMEL, CHERRY
</PRE>

<P ID="46">
<DT><B>See Also:</B><DD>

<A HREF="restart1.htm"><B>restart-bind</B></A>, <A HREF="with-sim.htm"><B>with-simple-restart</B></A>.

<P ID="47">
<DT><B>Notes:</B><DD>

<PRE ID="48">
 (restart-case <I>expression</I>
    (<I>name1</I> <I>arglist1</I> ...<I>options1</I>... . <I>body1</I>)
    (<I>name2</I> <I>arglist2</I> ...<I>options2</I>... . <I>body2</I>))
</PRE>
  is essentially equivalent to

<P ID="49">
<PRE ID="50">
 (block #1=#:g0001
   (let ((#2=#:g0002 nil))
        (tagbody
        (restart-bind ((name1 #'(lambda (&rest temp)
                                (setq #2# temp)
                                (go #3=#:g0003))
                          ...<I>slightly-transformed-options1</I>...)
                       (name2 #'(lambda (&rest temp)
                                (setq #2# temp)
                                (go #4=#:g0004))
                          ...<I>slightly-transformed-options2</I>...))
        (return-from #1# <I>expression</I>))
          #3# (return-from #1#
                  (apply #'(lambda <I>arglist1</I> . <I>body1</I>) #2#))
          #4# (return-from #1#
                  (apply #'(lambda <I>arglist2</I> . <I>body2</I>) #2#)))))
</PRE>

<P ID="51">
Unnamed restarts are generally only useful interactively
    and an interactive option which has no description is of little value.
    Implementations are encouraged to warn if 
an unnamed restart is used and no report information
    is provided
at compilation    time.  
At runtime, this error might be noticed when entering
      the debugger.  Since signaling an error would probably cause recursive
      entry into the debugger (causing yet another recursive error, etc.) it is
      suggested that the debugger print some indication of such problems when
      they occur but not actually signal errors.

<P ID="52">

<PRE ID="53">
 (restart-case (signal fred)
   (a ...)
   (b ...))
 ==
 (restart-case
     (with-condition-restarts fred 
                              (list (find-restart 'a) 
                                    (find-restart 'b))
       (signal fred))
   (a ...)
   (b ...))
</PRE>


<P ID="54">


<P ID="55">
<DT><B>Allegro CL Implementation Details:</B><DD>
 None.</DL>
</TD></TR></TABLE>
<HR NOSHADE>
<A HREF="../ansicl.htm" TARGET="_self"><IMG SRC="../images/a-top12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Home"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>

<A HREF="restart1.htm"><IMG SRC="../images/a-lft12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Previous"></A> 
<A HREF="../section/dictio15.htm" TARGET="_self"><IMG SRC="../images/a-up12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Up"></A> 
<A HREF="restart0.htm"><IMG SRC="../images/a-rgh12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Next"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/tableofc.htm" TARGET="_self"><IMG SRC="../images/toc.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Table of Contents"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/index.htm" TARGET="_self"><IMG SRC="../images/i16.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Index"></A>
<HR NOSHADE>

<SMALL><I><B>&#169; Franz Inc. 1998-2009</b> - File last updated 7-21-2009</I></SMALL>
</FONT>

</BODY>
</HTML>
