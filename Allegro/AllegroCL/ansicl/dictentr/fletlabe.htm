<!doctype HTML public "-//W3O//DTD W3 HTML 3.2//EN">
<HTML>
<HEAD>

<!-- 
  Document                : fletlabe.htm
  representing node       : flet, labels, macrolet  [ID:NO-392]
                 of class : DictEntry  [ID:SC-9]
  Generated by SchemaText : 1.52
  From HSDL source        : ansi cl
  At                      : 09:54:50 23.07.98

  About SchemaText        : http://www.schema.de
-->

<META NAME="GENERATOR" CONTENT="SchemaText 1.40f">
<META NAME="AUTHOR" CONTENT="Franz Inc.">
<META NAME="DATE" CONTENT="23.07.98">
<META NAME="TIME" CONTENT="09:51:09">
<META NAME="VERSION" CONTENT="520">

<TITLE>flet, labels, macrolet</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFFF">

<table border="0" width="100%" cellpadding="1" cellspacing="0">
  <tr>
    <td bgcolor="#00FFFF"><table border="0" cellpadding="5" cellspacing="3">
      <tr>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/contents.htm"><b>ToC</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/introduction.htm"><b>DocOverview</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/cgide.htm"><b>CGDoc</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/release-notes.htm"><b>RelNotes</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/index.htm"><b>Index</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/permuted-index.htm"><b>PermutedIndex</b></a></td>
      </tr>
    </table>
    </td>
    <td align="right"><b>Allegro CL</b>
    </td>
  </tr>
</table>

<A NAME="DictEntry_flet_labels_392"></A>
<FONT FACE="ARIAL,GENEVA,HELVETICA">
<A HREF="../ansicl.htm" TARGET="_self"><IMG SRC="../images/a-top12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Home"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>

<A HREF="fmakunbo.htm"><IMG SRC="../images/a-lft12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Previous"></A> 
<A HREF="../section/dictio19.htm" TARGET="_self"><IMG SRC="../images/a-up12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Up"></A> 
<A HREF="funcall.htm"><IMG SRC="../images/a-rgh12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Next"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/tableofc.htm" TARGET="_self"><IMG SRC="../images/toc.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Table of Contents"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/index.htm" TARGET="_self"><IMG SRC="../images/i16.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Index"></A>
<HR NOSHADE>
<TABLE WIDTH="90%"><TR>
<TD WIDTH=5%>&nbsp;</TD>
<TD WIDTH=95%>
<FONT SIZE=-2>
<A HREF="../ansicl.htm"> ANSI Common Lisp</A>&nbsp;&nbsp;<IMG SRC="../images/a-rgh6b.gif" BORDER=0 WIDTH=6 HEIGHT=6>&nbsp;<A HREF="../chapter/dataandc.htm">5 Data and Control Flow</A>&nbsp;&nbsp;<IMG SRC="../images/a-rgh6b.gif" BORDER=0 WIDTH=6 HEIGHT=6>&nbsp;<A HREF="../section/dictio19.htm">5.3 Dictionary of Data and Control Flow</A>

</FONT>
<P ID="2">
<TABLE BORDER=0 WIDTH="100%">
<TR>
<TD><FONT SIZE="+2">5.3.6  flet, labels, macrolet</FONT></TD>
<TD ALIGN=RIGHT><FONT SIZE="+1"><I>Special Operator</I></FONT></TD>
</TR></TABLE>
<DL>


<P ID="3">


<P ID="4">
<DT><B>Syntax:</B><DD>


<B>flet</B>
<I><NOBR>({(<I>function-name</I> 
				                  <I>lambda-list</I>
				      		  [[{<I>local-declaration</I>}* <I>|</I> <I>local-documentation</I>]]
				      		  {<I>local-form</I>}*)}*)</NOBR>
			  <NOBR>{<I>declaration</I>}* {<I>form</I>}*</NOBR></I><BR>&nbsp;
&nbsp;&nbsp;<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> <I>{<I>result</I>}*</I>
<P ID="5">
<B>labels</B>
<I><NOBR>({(<I>function-name</I> 
				                  <I>lambda-list</I>
				      		  [[{<I>local-declaration</I>}* <I>|</I> <I>local-documentation</I>]]
				      		  {<I>local-form</I>}*)}*)</NOBR>
			  <NOBR>{<I>declaration</I>}* {<I>form</I>}*</NOBR></I><BR>&nbsp;
&nbsp;&nbsp;<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> <I>{<I>result</I>}*</I>
<P ID="6">
<B>macrolet</B>
<I><NOBR>({(<I>name</I> 
				                  <I>lambda-list</I>
				      		  [[{<I>local-declaration</I>}* <I>|</I> <I>local-documentation</I>]]
				      		  {<I>local-form</I>}*)}*)</NOBR>
			  <NOBR>{<I>declaration</I>}* {<I>form</I>}*</NOBR></I><BR>&nbsp;
&nbsp;&nbsp;<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> <I>{<I>result</I>}*</I>
<P ID="7">


<P ID="8">
<DT><B>Arguments and Values:</B><DD>


<I>function-name</I> - a <I><A HREF="../glossary/f.htm#functionname">function name</A></I>.


<P ID="9">
<I>name</I> - a <I><A HREF="../glossary/s.htm#symbol">symbol</A></I>.


<P ID="10">
<I>lambda-list</I> - a <I><A HREF="../glossary/l.htm#lambdalist">lambda list</A></I>; 
		      for <A HREF="#DictEntry_flet_labels_392"><B>flet</B></A> and <A HREF="#DictEntry_flet_labels_392"><B>labels</B></A>,
			 it is an <I><A HREF="../glossary/o.htm#ordinarylambdalist">ordinary lambda list</A></I>;
		      for <A HREF="#DictEntry_flet_labels_392"><B>macrolet</B></A>,
			 it is a <I><A HREF="../glossary/m.htm#macrolambdalist">macro lambda list</A></I>.

<P ID="11">
<I>local-declaration</I> - a <A HREF="declare.htm"><B>declare</B></A> <I><A HREF="../glossary/e.htm#expression">expression</A></I>; not evaluated.

<P ID="12">
<I>declaration</I> - a <A HREF="declare.htm"><B>declare</B></A> <I><A HREF="../glossary/e.htm#expression">expression</A></I>; not evaluated.

<P ID="13">
<I>local-documentation</I> - a <I><A HREF="../glossary/s.htm#string">string</A></I>; not evaluated.

<P ID="14">
<I>local-forms</I>, <I>forms</I> - an <I><A HREF="../glossary/i.htm#implicitprogn">implicit progn</A></I>.

<P ID="15">
<I>results</I> - the <I><A HREF="../glossary/v.htm#value">values</A></I> of the <I>forms</I>.

<P ID="16">
<DT><B>Description:</B><DD>

<A HREF="#DictEntry_flet_labels_392"><B>flet</B></A>, <A HREF="#DictEntry_flet_labels_392"><B>labels</B></A>, and <A HREF="#DictEntry_flet_labels_392"><B>macrolet</B></A>
define local <I><A HREF="../glossary/f.htm#function">functions</A></I> and <I><A HREF="../glossary/m.htm#macro">macros</A></I>, and execute
<I>forms</I> using the local definitions.
<I>Forms</I> are executed  in order of occurrence.

<P ID="17">



The body forms (but not the <I><A HREF="../glossary/l.htm#lambdalist">lambda list</A></I>)

of each <I><A HREF="../glossary/f.htm#function">function</A></I> created by <A HREF="#DictEntry_flet_labels_392"><B>flet</B></A> and <A HREF="#DictEntry_flet_labels_392"><B>labels</B></A> 
and each <I><A HREF="../glossary/m.htm#macro">macro</A></I> created by <A HREF="#DictEntry_flet_labels_392"><B>macrolet</B></A>
are enclosed in an <I><A HREF="../glossary/i.htm#implicitblock">implicit block</A></I> whose name 
is the <I><A HREF="../glossary/f.htm#functionblockname">function block name</A></I> of the <I>function-name</I> or <I>name</I>, 
as appropriate.



<P ID="18">

The scope of the <I>declarations</I>
between
the list of local function/macro definitions and the body <I>forms</I>
in <A HREF="#DictEntry_flet_labels_392"><B>flet</B></A> and <A HREF="#DictEntry_flet_labels_392"><B>labels</B></A> 
does not include the bodies of the
locally defined <I><A HREF="../glossary/f.htm#function">functions</A></I>, except that for <A HREF="#DictEntry_flet_labels_392"><B>labels</B></A>,
any <A HREF="inlineno.htm"><B>inline</B></A>, <A HREF="inlineno.htm"><B>notinline</B></A>, or <A HREF="ftype.htm"><B>ftype</B></A> declarations
that refer to the locally defined functions do apply to the local function
bodies. That is, their <I><A HREF="../glossary/s.htm#scope">scope</A></I> 
is the same as the function name that they
affect.  



The scope of these <I>declarations</I> 
does not include the bodies of the macro expander
functions defined by <A HREF="#DictEntry_flet_labels_392"><B>macrolet</B></A>.  


<P ID="19">
<UL>
<LI ID="20"><B>flet</B>

<P ID="21">

<A HREF="#DictEntry_flet_labels_392"><B>flet</B></A> defines locally named <I><A HREF="../glossary/f.htm#function">functions</A></I> and executes a series of
<I>forms</I> with these definition <I><A HREF="../glossary/b.htm#binding">bindings</A></I>.  Any number of
such local <I><A HREF="../glossary/f.htm#function">functions</A></I> can be defined.  

<P ID="22">
The <I><A HREF="../glossary/s.htm#scope">scope</A></I> of the name <I><A HREF="../glossary/b.htm#binding">binding</A></I> encompasses only the body.
Within the
body of <A HREF="#DictEntry_flet_labels_392"><B>flet</B></A>, 
<I>function-names</I> matching those defined
by <A HREF="#DictEntry_flet_labels_392"><B>flet</B></A> 
refer to the locally defined <I><A HREF="../glossary/f.htm#function">functions</A></I> 
rather than to
the global function definitions of the same name.


Also, within the scope of <A HREF="#DictEntry_flet_labels_392"><B>flet</B></A>, 
global <I><A HREF="../glossary/s.htm#setfexpander">setf expander</A></I> definitions of the <I>function-name</I>
defined by <A HREF="#DictEntry_flet_labels_392"><B>flet</B></A> do not apply. 


Note that this applies to 
<TT>(defsetf <I>f</I> ...)</TT>, not
<TT>(defmethod (setf <I>f</I>) ...)</TT>.



<P ID="23">
The names of <I><A HREF="../glossary/f.htm#function">functions</A></I> defined by <A HREF="#DictEntry_flet_labels_392"><B>flet</B></A> 
are in the <I><A HREF="../glossary/l.htm#lexicalenvironment">lexical environment</A></I>; they retain
their local definitions only within the body of <A HREF="#DictEntry_flet_labels_392"><B>flet</B></A>.
The function definition bindings are visible only in
the body of <A HREF="#DictEntry_flet_labels_392"><B>flet</B></A>, not the definitions themselves.  Within the
function definitions, local function names
that match those being
defined refer to <I><A HREF="../glossary/f.htm#function">functions</A></I> or 
<I><A HREF="../glossary/m.htm#macro">macros</A></I> defined outside the <A HREF="#DictEntry_flet_labels_392"><B>flet</B></A>.
<A HREF="#DictEntry_flet_labels_392"><B>flet</B></A> can locally <I><A HREF="../glossary/s.htm#shadow">shadow</A></I> a global function name,
and the new definition can refer to the global definition.

<P ID="24">
Any <I>local-documentation</I> is attached to the corresponding local <I>function</I>
(if one is actually created) as a <I><A HREF="../glossary/d.htm#documentationstring">documentation string</A></I>.

<P ID="25">
<LI ID="26"><B>labels</B>

<P ID="27">

<A HREF="#DictEntry_flet_labels_392"><B>labels</B></A> is equivalent to <A HREF="#DictEntry_flet_labels_392"><B>flet</B></A> except that
the scope of the defined function names for <A HREF="#DictEntry_flet_labels_392"><B>labels</B></A> 
encompasses the function definitions themselves as well as the body.







<P ID="28">
<LI ID="29"><B>macrolet</B>

<P ID="30">

<A HREF="#DictEntry_flet_labels_392"><B>macrolet</B></A> 
establishes local <I><A HREF="../glossary/m.htm#macro">macro</A></I> definitions,
using the same format used by <A HREF="defmacro.htm"><B>defmacro</B></A>.

<P ID="31">





Within the body of <A HREF="#DictEntry_flet_labels_392"><B>macrolet</B></A>, 
global <I><A HREF="../glossary/s.htm#setfexpander">setf expander</A></I> definitions of the <I>names</I> defined by the 
<A HREF="#DictEntry_flet_labels_392"><B>macrolet</B></A> do not apply; rather, <A HREF="setfpset.htm"><B>setf</B></A> expands the
<I><A HREF="../glossary/m.htm#macroform">macro form</A></I> and recursively process the resulting <I><A HREF="../glossary/f.htm#form">form</A></I>.






<P ID="32">

The macro-expansion functions defined by <A HREF="#DictEntry_flet_labels_392"><B>macrolet</B></A> 
are defined in the 

<I><A HREF="../glossary/l.htm#lexicalenvironment">lexical environment</A></I> in which the <A HREF="#DictEntry_flet_labels_392"><B>macrolet</B></A> form appears.

Declarations and <A HREF="#DictEntry_flet_labels_392"><B>macrolet</B></A> and 
<A HREF="symbol-m.htm"><B>symbol-macrolet</B></A> definitions
affect the local macro definitions in a <A HREF="#DictEntry_flet_labels_392"><B>macrolet</B></A>, but the
consequences are undefined if the local macro definitions reference
any local <I><A HREF="../glossary/v.htm#variable">variable</A></I> or <I><A HREF="../glossary/f.htm#function">function</A></I> <I><A HREF="../glossary/b.htm#binding">bindings</A></I> that are visible in that
<I><A HREF="../glossary/l.htm#lexicalenvironment">lexical environment</A></I>.



<P ID="33">
Any <I>local-documentation</I> is attached to the corresponding local <I>macro function</I>
as a <I><A HREF="../glossary/d.htm#documentationstring">documentation string</A></I>.

</UL>

<P ID="34">
<DT><B>Examples:</B><DD>

<PRE ID="35">
 (defun foo (x flag)
   (macrolet ((fudge (z)
                 ;The parameters x and flag are not accessible
                 ; at this point; a reference to flag would be to
                 ; the global variable of that name.
                 `&nbsp;(if flag (* ,z ,z) ,z)))
    ;The parameters x and flag are accessible here.
     (+ x
        (fudge x)
        (fudge (+ x 1)))))
 ==
 (defun foo (x flag)
   (+ x
      (if flag (* x x) x)
      (if flag (* (+ x 1) (+ x 1)) (+ x 1))))
</PRE>
after macro expansion.  The occurrences of <TT>x</TT> and <TT>flag</TT> legitimately
refer to the parameters of the function <TT>foo</TT> because those parameters are
visible at the site of the macro call which produced the expansion.

<P ID="36">



<P ID="37">
<PRE ID="38">
 (flet ((flet1 (n) (+ n n)))
    (flet ((flet1 (n) (+ 2 (flet1 n))))
      (flet1 2))) <IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> 6

 (defun -function () 'top-level) <IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9>  DUMMY-FUNCTION 
 (funcall #'-function) <IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9>  TOP-LEVEL 
 (flet ((-function () 'shadow)) 
      (funcall #'-function)) <IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9>  SHADOW 
 (eq (funcall #'-function) (funcall '-function))
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> <I><A HREF="../glossary/t.htm#true">true</A></I> 
 (flet ((-function () 'shadow))
   (eq (funcall #'-function)
       (funcall '-function)))
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> <I><A HREF="../glossary/f.htm#false">false</A></I> 

 (defun recursive-times (k n)
   (labels ((temp (n) 
              (if (zerop n) 0 (+ k (temp (1- n))))))
     (temp n))) <IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9>  RECURSIVE-TIMES
 (recursive-times 2 3) <IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> 6

 (defmacro mlets (x &environment env) 
    (let ((form `(babbit ,x)))
      (macroexpand form env))) <IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9>  MLETS
 (macrolet ((babbit (z) `(+ ,z ,z))) (mlets 5)) <IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> 10
</PRE>

<P ID="39">
<PRE ID="40">
 (flet ((safesqrt (x) (sqrt (abs x))))
  ;; The safesqrt function is used in two places.
   (safesqrt (apply #'+ (map 'list #'safesqrt '(1 2 3 4 5 6)))))
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> 3.291173
</PRE>

<P ID="41">
<PRE ID="42">
 (defun integer-power (n k)     
   (declare (integer n))         
   (declare (type (integer 0 *) k))
   (labels ((expt0 (x k a)
              (declare (integer x a) (type (integer 0 *) k))
              (cond ((zerop k) a)
                    ((evenp k) (expt1 (* x x) (floor k 2) a))
                    (t (expt0 (* x x) (floor k 2) (* x a)))))
            (expt1 (x k a)
              (declare (integer x a) (type (integer 0 *) k))
              (cond ((evenp k) (expt1 (* x x) (floor k 2) a))
                    (t (expt0 (* x x) (floor k 2) (* x a))))))
    (expt0 n k 1))) <IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9>  INTEGER-POWER
</PRE>

<P ID="43">

<PRE ID="44">
 (defun example (y l)
   (flet ((attach (x)
            (setq l (append l (list x)))))
     (declare (inline attach))
     (dolist (x y)
       (unless (null (cdr x))
         (attach x)))
     l))

 (example '((a apple apricot) (b banana) (c cherry) (d) (e))
          '((1) (2) (3) (4 2) (5) (6 3 2)))
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> ((1) (2) (3) (4 2) (5) (6 3 2) (A APPLE APRICOT) (B BANANA) (C CHERRY))
</PRE>


<P ID="45">
<DT><B>See Also:</B><DD>

<A HREF="declare.htm"><B>declare</B></A>,
<A HREF="defmacro.htm"><B>defmacro</B></A>,
<A HREF="defun.htm"><B>defun</B></A>,
<A HREF="document.htm"><B>documentation</B></A>,
<A HREF="letlet.htm"><B>let</B></A>,
Section <A HREF="../section/evaluati.htm">3.1 Evaluation</A>,
Section <A HREF="../subsecti/syntacti.htm">3.4.11 Syntactic Interaction of Documentation Strings and Declarations</A>

<P ID="46">
<DT><B>Notes:</B><DD>

It is not possible to define recursive <I><A HREF="../glossary/f.htm#function">functions</A></I> with <A HREF="#DictEntry_flet_labels_392"><B>flet</B></A>.
<A HREF="#DictEntry_flet_labels_392"><B>labels</B></A> can be used to define mutually recursive <I><A HREF="../glossary/f.htm#function">functions</A></I>.

<P ID="47">
If a <A HREF="#DictEntry_flet_labels_392"><B>macrolet</B></A> <I><A HREF="../glossary/f.htm#form">form</A></I> is a <I><A HREF="../glossary/t.htm#toplevelform">top level form</A></I>,
the body <I>forms</I> are also processed as <I><A HREF="../glossary/t.htm#toplevelform">top level forms</A></I>.
See Section <A HREF="../subsecti/filecomp.htm">3.2.3 File Compilation</A>.

<P ID="48">


<P ID="49">
<DT><B>Allegro CL Implementation Details:</B><DD>
 None.</DL>
</TD></TR></TABLE>
<HR NOSHADE>
<A HREF="../ansicl.htm" TARGET="_self"><IMG SRC="../images/a-top12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Home"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>

<A HREF="fmakunbo.htm"><IMG SRC="../images/a-lft12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Previous"></A> 
<A HREF="../section/dictio19.htm" TARGET="_self"><IMG SRC="../images/a-up12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Up"></A> 
<A HREF="funcall.htm"><IMG SRC="../images/a-rgh12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Next"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/tableofc.htm" TARGET="_self"><IMG SRC="../images/toc.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Table of Contents"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/index.htm" TARGET="_self"><IMG SRC="../images/i16.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Index"></A>
<HR NOSHADE>

<SMALL><I><B>&#169; Franz Inc. 1998-2009</b> - File last updated 7-21-2009</I></SMALL>
</FONT>

</BODY>
</HTML>
