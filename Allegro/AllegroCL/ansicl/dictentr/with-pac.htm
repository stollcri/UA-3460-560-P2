<!doctype HTML public "-//W3O//DTD W3 HTML 3.2//EN">
<HTML>
<HEAD>

<!-- 
  Document                : with_pac.htm
  representing node       : with_package_iterator  [ID:NO-728]
                 of class : DictEntry  [ID:SC-9]
  Generated by SchemaText : 1.52
  From HSDL source        : ansi cl
  At                      : 09:53:40 23.07.98

  About SchemaText        : http://www.schema.de
-->

<META NAME="GENERATOR" CONTENT="SchemaText 1.40f">
<META NAME="AUTHOR" CONTENT="Franz Inc.">
<META NAME="DATE" CONTENT="23.07.98">
<META NAME="TIME" CONTENT="09:51:09">
<META NAME="VERSION" CONTENT="520">

<TITLE>with-package-iterator</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFFF">

<table border="0" width="100%" cellpadding="1" cellspacing="0">
  <tr>
    <td bgcolor="#00FFFF"><table border="0" cellpadding="5" cellspacing="3">
      <tr>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/contents.htm"><b>ToC</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/introduction.htm"><b>DocOverview</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/cgide.htm"><b>CGDoc</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/release-notes.htm"><b>RelNotes</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/index.htm"><b>Index</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/permuted-index.htm"><b>PermutedIndex</b></a></td>
      </tr>
    </table>
    </td>
    <td align="right"><b>Allegro CL</b>
    </td>
  </tr>
</table>

<A NAME="DictEntry_with_package_728"></A>
<FONT FACE="ARIAL,GENEVA,HELVETICA">
<A HREF="../ansicl.htm" TARGET="_self"><IMG SRC="../images/a-top12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Home"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>

<A HREF="make-pac.htm"><IMG SRC="../images/a-lft12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Previous"></A> 
<A HREF="../section/dictio13.htm" TARGET="_self"><IMG SRC="../images/a-up12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Up"></A> 
<A HREF="unexport.htm"><IMG SRC="../images/a-rgh12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Next"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/tableofc.htm" TARGET="_self"><IMG SRC="../images/toc.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Table of Contents"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/index.htm" TARGET="_self"><IMG SRC="../images/i16.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Index"></A>
<HR NOSHADE>
<TABLE WIDTH="90%"><TR>
<TD WIDTH=5%>&nbsp;</TD>
<TD WIDTH=95%>
<FONT SIZE=-2>
<A HREF="../ansicl.htm"> ANSI Common Lisp</A>&nbsp;&nbsp;<IMG SRC="../images/a-rgh6b.gif" BORDER=0 WIDTH=6 HEIGHT=6>&nbsp;<A HREF="../chapter/packages.htm">11 Packages</A>&nbsp;&nbsp;<IMG SRC="../images/a-rgh6b.gif" BORDER=0 WIDTH=6 HEIGHT=6>&nbsp;<A HREF="../section/dictio13.htm">11.2 Dictionary of Packages</A>

</FONT>
<P ID="2">
<TABLE BORDER=0 WIDTH="100%">
<TR>
<TD><FONT SIZE="+2">11.2.13  with-package-iterator</FONT></TD>
<TD ALIGN=RIGHT><FONT SIZE="+1"><I>Macro</I></FONT></TD>
</TR></TABLE>
<DL>


<P ID="3">


<P ID="4">


<P ID="5">
<DT><B>Syntax:</B><DD>

<B>with-package-iterator</B> (<I>name package-list-form</I> <TT>&amp;rest</TT> 
<I>symbol-types</I>){<I>declaration</I>}* 
{<I>form</I>}*<BR>
&nbsp;&nbsp;<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> {<I>result</I>}*

<P ID="6">
<DT><B>Arguments and Values:</B><DD>



<I>name</I> - a <I><A HREF="../glossary/s.htm#symbol">symbol</A></I>.

<P ID="7">
<I>package-list-form</I> - a <I><A HREF="../glossary/f.htm#form">form</A></I>; evaluated once to produce a <I>package-list</I>.

<P ID="8">
<I>package-list</I> - a <I><A HREF="../glossary/d.htm#designator">designator</A></I> for a list of <I><A HREF="../glossary/p.htm#packagedesignator">package designators</A></I>.

<P ID="9">
<I>symbol-type</I> - one of the <I><A HREF="../glossary/s.htm#symbol">symbols</A></I> 
		      <TT>:internal</TT>, <TT>:external</TT>, or <TT>:inherited</TT>.

<P ID="10">
<I>declaration</I> - a <A HREF="declare.htm"><B>declare</B></A> <I><A HREF="../glossary/e.htm#expression">expression</A></I>; not evaluated.

<P ID="11">
<I>forms</I> - an <I><A HREF="../glossary/i.htm#implicitprogn">implicit progn</A></I>.

<P ID="12">
<I>results</I> - the <I><A HREF="../glossary/v.htm#value">values</A></I> of the <I>forms</I>.

<P ID="13">
<DT><B>Description:</B><DD>

Within the lexical scope of the body <I>forms</I>,
the <I>name</I> is defined via <A HREF="fletlabe.htm"><B>macrolet</B></A> 
such that successive invocations of <TT>(<I>name</I>)</TT>
will return the <I><A HREF="../glossary/s.htm#symbol">symbols</A></I>, one by one, 
from the <I><A HREF="../glossary/p.htm#package">packages</A></I> in <I>package-list</I>. 

<P ID="14">
It is unspecified whether <I><A HREF="../glossary/s.htm#symbol">symbols</A></I> inherited from
multiple <I><A HREF="../glossary/p.htm#package">packages</A></I> are returned more than once.  
The order of <I><A HREF="../glossary/s.htm#symbol">symbols</A></I> returned does not necessarily reflect the order
of <I><A HREF="../glossary/p.htm#package">packages</A></I> in <I>package-list</I>.  When <I>package-list</I> has 
more than one element, it is unspecified whether duplicate <I><A HREF="../glossary/s.htm#symbol">symbols</A></I> are
returned once or more than once.  

<P ID="15">
<I>Symbol-types</I> controls which <I><A HREF="../glossary/s.htm#symbol">symbols</A></I> that are <I><A HREF="../glossary/a.htm#accessible">accessible</A></I>
in a <I><A HREF="../glossary/p.htm#package">package</A></I> are returned as follows:

<P ID="16">
<UL>
<LI ID="17"><TT>:internal</TT>

<P ID="18">
  The <I><A HREF="../glossary/s.htm#symbol">symbols</A></I> that are <I><A HREF="../glossary/p.htm#present">present</A></I> in the <I><A HREF="../glossary/p.htm#package">package</A></I>,
  but that are not <I><A HREF="../glossary/e.htm#exported">exported</A></I>.

<P ID="19">
<LI ID="20"><TT>:external</TT>

<P ID="21">
  The <I><A HREF="../glossary/s.htm#symbol">symbols</A></I> that are <I><A HREF="../glossary/p.htm#present">present</A></I> in the <I><A HREF="../glossary/p.htm#package">package</A></I>
  and are <I><A HREF="../glossary/e.htm#exported">exported</A></I>.

<P ID="22">
<LI ID="23"><TT>:inherited</TT>

<P ID="24">
  The <I><A HREF="../glossary/s.htm#symbol">symbols</A></I> that are <I><A HREF="../glossary/e.htm#exported">exported</A></I> by used <I><A HREF="../glossary/p.htm#package">packages</A></I>
  and that are not <I>shadowed</I>.
</UL>

<P ID="25">
When more than one argument is supplied for <I>symbol-types</I>, 
a <I><A HREF="../glossary/s.htm#symbol">symbol</A></I> is returned if its <I><A HREF="../glossary/a.htm#accessibility">accessibility</A></I> matches 
any one of the <I>symbol-types</I> supplied.  
Implementations may extend this syntax by recognizing additional 
symbol accessibility types.

<P ID="26">
An invocation of <TT>(<I>name</I>)</TT> returns four values as follows:

<P ID="27">
<UL>
<LI ID="28">1. A flag that indicates whether a <I><A HREF="../glossary/s.htm#symbol">symbol</A></I> is returned
	      (true means that a <I><A HREF="../glossary/s.htm#symbol">symbol</A></I> is returned).
<LI ID="29">2. A <I><A HREF="../glossary/s.htm#symbol">symbol</A></I> that is <I><A HREF="../glossary/a.htm#accessible">accessible</A></I> in one the
	      indicated <I><A HREF="../glossary/p.htm#package">packages</A></I>.
<LI ID="30">3. The accessibility type for that <I><A HREF="../glossary/s.htm#symbol">symbol</A></I>; 
	      <I>i.e.</I>,  one of the symbols <TT>:internal</TT>, <TT>:external</TT>, or <TT>:inherited</TT>.
<LI ID="31">4. The <I><A HREF="../glossary/p.htm#package">package</A></I> from which the <I><A HREF="../glossary/s.htm#symbol">symbol</A></I> was obtained.
	      The <I><A HREF="../glossary/p.htm#package">package</A></I> is one of the <I><A HREF="../glossary/p.htm#package">packages</A></I> present 
	      or named in <I>package-list</I>.
</UL>

<P ID="32">
After all <I><A HREF="../glossary/s.htm#symbol">symbols</A></I> have been returned by successive invocations of
<TT>(<I>name</I>)</TT>, then only one value is returned, namely <A HREF="nil.htm"><B>nil</B></A>.

<P ID="33">
The meaning of the second, third, and fourth <I><A HREF="../glossary/v.htm#value">values</A></I> is that the returned 
<I><A HREF="../glossary/s.htm#symbol">symbol</A></I> is <I><A HREF="../glossary/a.htm#accessible">accessible</A></I> in the returned <I><A HREF="../glossary/p.htm#package">package</A></I>
in the way indicated by the second return value as follows:

<P ID="34">
<UL>
<LI ID="35"><TT>:internal</TT>

<P ID="36">
Means <I><A HREF="../glossary/p.htm#present">present</A></I> and not <I><A HREF="../glossary/e.htm#exported">exported</A></I>.

<P ID="37">
<LI ID="38"><TT>:external</TT>

<P ID="39">
Means <I><A HREF="../glossary/p.htm#present">present</A></I> and <I><A HREF="../glossary/e.htm#exported">exported</A></I>.

<P ID="40">
<LI ID="41"><TT>:inherited</TT>

<P ID="42">
Means not <I><A HREF="../glossary/p.htm#present">present</A></I> (thus not <I>shadowed</I>) but inherited
from some used <I><A HREF="../glossary/p.htm#package">package</A></I>.
</UL>

<P ID="43">
It is unspecified what happens if any of the implicit interior state 
of an iteration is returned outside the dynamic extent of the 
<A HREF="#DictEntry_with_package_728"><B>with-package-iterator</B></A>
form such as by returning some <I><A HREF="../glossary/c.htm#closure">closure</A></I> over the invocation <I><A HREF="../glossary/f.htm#form">form</A></I>.

<P ID="44">
Any number of invocations of <A HREF="#DictEntry_with_package_728"><B>with-package-iterator</B></A> 
can be nested, and the body of the innermost one can invoke all of the
locally <I>established</I> <I><A HREF="../glossary/m.htm#macro">macros</A></I>, provided all those <I><A HREF="../glossary/m.htm#macro">macros</A></I>
have distinct names.

<P ID="45">
<DT><B>Examples:</B><DD>

The following function should return <A HREF="t.htm"><B>t</B></A>&nbsp;on any <I><A HREF="../glossary/p.htm#package">package</A></I>, and signal
an error if the usage of <A HREF="#DictEntry_with_package_728"><B>with-package-iterator</B></A> does not agree
with the corresponding usage of <A HREF="do-symbo.htm"><B>do-symbols</B></A>.

<P ID="46">
<PRE ID="47">
 (defun test-package-iterator (package)
   (unless (packagep package)
     (setq package (find-package package)))
   (let ((all-entries '())
         (generated-entries '()))
     (do-symbols (x package) 
       (multiple-value-bind (symbol accessibility) 
           (find-symbol (symbol-name x) package)
         (push (list symbol accessibility) all-entries)))
     (with-package-iterator (generator-fn package 
                             :internal :external :inherited)
       (loop     
         (multiple-value-bind (more? symbol accessibility pkg)
             (generator-fn)
           (unless more? (return))
           (let ((l (multiple-value-list (find-symbol (symbol-name symbol) 
                                                      package))))
             (unless (equal l (list symbol accessibility))
               (error "Symbol ~S not found as ~S in package ~A [~S]"
                      symbol accessibility (package-name package) l))
             (push l generated-entries)))))
     (unless (and (subsetp all-entries generated-entries :test #'equal)
                  (subsetp generated-entries all-entries :test #'equal))
      (error "Generated entries and Do-Symbols entries don't correspond"))
     t))
</PRE>

<P ID="48">
The following function prints out every <I><A HREF="../glossary/p.htm#present">present</A></I> <I><A HREF="../glossary/s.htm#symbol">symbol</A></I> 
(possibly more than once):

<P ID="49">
<PRE ID="50">
 (defun print-all-symbols () 
   (with-package-iterator (next-symbol (list-all-packages)
                           :internal :external)
     (loop
       (multiple-value-bind (more? symbol) (next-symbol)
         (if more? 
            (print symbol)
            (return))))))
</PRE>

<P ID="51">
<DT><B>Exceptional Situations:</B><DD>

<A HREF="#DictEntry_with_package_728"><B>with-package-iterator</B></A> signals an error of <I><A HREF="../glossary/t.htm#type">type</A></I> <A HREF="program-.htm"><B>program-error</B></A> if 
no <I>symbol-types</I> are supplied or if a <I>symbol-type</I> is not
recognized  by the implementation is supplied.  

<P ID="52">
The consequences are undefined if the local function named <I>name</I>
<I>established</I> by <A HREF="#DictEntry_with_package_728"><B>with-package-iterator</B></A> is called after it 
has returned <I><A HREF="../glossary/f.htm#false">false</A></I> as its <I><A HREF="../glossary/p.htm#primaryvalue">primary value</A></I>.

<P ID="53">
<DT><B>See Also:</B><DD>


Section <A HREF="../section/traversa.htm">3.6 Traversal Rules and Side Effects</A>


<P ID="54">



<P ID="55">
<DT><B>Allegro CL Implementation Details:</B><DD>
 None.</DL>
</TD></TR></TABLE>
<HR NOSHADE>
<A HREF="../ansicl.htm" TARGET="_self"><IMG SRC="../images/a-top12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Home"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>

<A HREF="make-pac.htm"><IMG SRC="../images/a-lft12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Previous"></A> 
<A HREF="../section/dictio13.htm" TARGET="_self"><IMG SRC="../images/a-up12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Up"></A> 
<A HREF="unexport.htm"><IMG SRC="../images/a-rgh12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Next"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/tableofc.htm" TARGET="_self"><IMG SRC="../images/toc.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Table of Contents"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/index.htm" TARGET="_self"><IMG SRC="../images/i16.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Index"></A>
<HR NOSHADE>

<SMALL><I><B>&#169; Franz Inc. 1998-2009</b> - File last updated 7-21-2009</I></SMALL>
</FONT>

</BODY>
</HTML>
