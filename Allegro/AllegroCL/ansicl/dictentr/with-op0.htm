<!doctype HTML public "-//W3O//DTD W3 HTML 3.2//EN">
<HTML>
<HEAD>

<!-- 
  Document                : with_op0.htm
  representing node       : with_open_file  [ID:NO-1222]
                 of class : DictEntry  [ID:SC-9]
  Generated by SchemaText : 1.52
  From HSDL source        : ansi cl
  At                      : 09:52:11 23.07.98

  About SchemaText        : http://www.schema.de
-->

<META NAME="GENERATOR" CONTENT="SchemaText 1.40f">
<META NAME="AUTHOR" CONTENT="Franz Inc.">
<META NAME="DATE" CONTENT="23.07.98">
<META NAME="TIME" CONTENT="09:51:09">
<META NAME="VERSION" CONTENT="520">

<TITLE>with-open-file</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFFF">

<table border="0" width="100%" cellpadding="1" cellspacing="0">
  <tr>
    <td bgcolor="#00FFFF"><table border="0" cellpadding="5" cellspacing="3">
      <tr>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/contents.htm"><b>ToC</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/introduction.htm"><b>DocOverview</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/cgide.htm"><b>CGDoc</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/release-notes.htm"><b>RelNotes</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/index.htm"><b>Index</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/permuted-index.htm"><b>PermutedIndex</b></a></td>
      </tr>
    </table>
    </td>
    <td align="right"><b>Allegro CL</b>
    </td>
  </tr>
</table>

<A NAME="DictEntry_with_open_fi_1222"></A>
<FONT FACE="ARIAL,GENEVA,HELVETICA">
<A HREF="../ansicl.htm" TARGET="_self"><IMG SRC="../images/a-top12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Home"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>

<A HREF="stream-1.htm"><IMG SRC="../images/a-lft12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Previous"></A> 
<A HREF="../section/diction3.htm" TARGET="_self"><IMG SRC="../images/a-up12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Up"></A> 
<A HREF="close.htm"><IMG SRC="../images/a-rgh12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Next"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/tableofc.htm" TARGET="_self"><IMG SRC="../images/toc.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Table of Contents"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/index.htm" TARGET="_self"><IMG SRC="../images/i16.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Index"></A>
<HR NOSHADE>
<TABLE WIDTH="90%"><TR>
<TD WIDTH=5%>&nbsp;</TD>
<TD WIDTH=95%>
<FONT SIZE=-2>
<A HREF="../ansicl.htm"> ANSI Common Lisp</A>&nbsp;&nbsp;<IMG SRC="../images/a-rgh6b.gif" BORDER=0 WIDTH=6 HEIGHT=6>&nbsp;<A HREF="../chapter/streams.htm">21 Streams</A>&nbsp;&nbsp;<IMG SRC="../images/a-rgh6b.gif" BORDER=0 WIDTH=6 HEIGHT=6>&nbsp;<A HREF="../section/diction3.htm">21.2 Dictionary of Streams</A>

</FONT>
<P ID="2">
<TABLE BORDER=0 WIDTH="100%">
<TR>
<TD><FONT SIZE="+2">21.2.31  with-open-file</FONT></TD>
<TD ALIGN=RIGHT><FONT SIZE="+1"><I>macro</I></FONT></TD>
</TR></TABLE>
<DL>


<P ID="3">


<P ID="4">
<DT><B>Syntax:</B><DD>

<B>with-open-file</B>
<I>(stream filespec {<I>options</I>}*)
		   {<I>declaration</I>}*
		   {<I>form</I>}*</I><BR>&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> <I>results</I>
<P ID="5">
<DT><B>Arguments and Values:</B><DD>

<I>stream</I> -- a variable.

<P ID="6">

<I>filespec</I> - a <I><A HREF="../glossary/p.htm#pathnamedesignator">pathname designator</A></I>.


<P ID="7">

<I>options</I> -- <I><A HREF="../glossary/f.htm#form">forms</A></I>; evaluated.

<P ID="8">
<I>declaration</I> - a <A HREF="declare.htm"><B>declare</B></A> <I><A HREF="../glossary/e.htm#expression">expression</A></I>; not evaluated.

<P ID="9">
<I>forms</I> - an <I><A HREF="../glossary/i.htm#implicitprogn">implicit progn</A></I>.

<P ID="10">
<I>results</I> - the <I><A HREF="../glossary/v.htm#value">values</A></I> returned by the <I>forms</I>.

<P ID="11">
<DT><B>Description:</B><DD>


<A HREF="#DictEntry_with_open_fi_1222"><B>with-open-file</B></A> uses <A HREF="open.htm"><B>open</B></A> to create a <I><A HREF="../glossary/f.htm#filestream">file stream</A></I>

to <I><A HREF="../glossary/f.htm#file">file</A></I> named by <I>filespec</I>. 

<I>Filespec</I> is the name of the file to be opened.
<I>Options</I> are used as keyword arguments to <A HREF="open.htm"><B>open</B></A>.
<P ID="12">

The <I><A HREF="../glossary/s.htm#stream">stream</A></I> <I><A HREF="../glossary/o.htm#object">object</A></I> to which the <I>stream</I> <I><A HREF="../glossary/v.htm#variable">variable</A></I> 
is <I><A HREF="../glossary/b.htm#bound">bound</A></I> has <I><A HREF="../glossary/d.htm#dynamicextent">dynamic extent</A></I>;
its <I><A HREF="../glossary/e.htm#extent">extent</A></I> ends when the <I><A HREF="../glossary/f.htm#form">form</A></I> is exited.


<P ID="13">

<A HREF="#DictEntry_with_open_fi_1222"><B>with-open-file</B></A> evaluates the <I>forms</I> as an <I><A HREF="../glossary/i.htm#implicitprogn">implicit progn</A></I> 
with <I>stream</I> bound to 

the value returned by <A HREF="open.htm"><B>open</B></A>.


<P ID="14">

When control leaves the body, either normally or abnormally (such as by
use of <A HREF="throw.htm"><B>throw</B></A>), the file is automatically closed.  If a new
output file is being written, and control leaves abnormally, the file is
aborted and the file system is left, so far as possible, as if the file
had never been opened.  

<P ID="15">
It is possible by the use of <TT>:if-exists nil</TT> 
or <TT>:if-does-not-exist nil</TT> for
<I>stream</I> to be bound to <A HREF="nil.htm"><B>nil</B></A>.

Users of <TT>:if-does-not-exist nil</TT> should check for a valid <I><A HREF="../glossary/s.htm#stream">stream</A></I>.


<P ID="16">

The consequences are undefined if an attempt is made to <I><A HREF="../glossary/a.htm#assign">assign</A></I> the 
<I>stream</I> <I><A HREF="../glossary/v.htm#variable">variable</A></I>.  The compiler may choose to issue a
warning if such an attempt is detected.


<P ID="17">
<DT><B>Examples:</B><DD>

<PRE ID="18">
 (setq p (merge-pathnames "test"))

<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> #&lt;PATHNAME :HOST NIL :DEVICE <I>device-name</I> :DIRECTORY <I>directory-name</I>
    :NAME "test" :TYPE NIL :VERSION :NEWEST&gt;
 (with-open-file (s p :direction :output :if-exists :supersede)
    (format s "Here are a couple~%of test data lines~%")) <IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9>  NIL
 (with-open-file (s p)
    (do ((l (read-line s) (read-line s nil 'eof)))
        ((eq l 'eof) "Reached end of file.")
     (format t "~&*** ~A~%" l)))
<IMG SRC="../images/triangle.gif" BORDER=0 WIDTH=10 HEIGHT=9>*** Here are a couple
<IMG SRC="../images/triangle.gif" BORDER=0 WIDTH=10 HEIGHT=9>*** of test data lines
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> "Reached end of file."
</PRE>

<P ID="19">


<PRE ID="20">
;; Normally one would not do this intentionally because it is
;; not perspicuous, but beware when using :IF-DOES-NOT-EXIST NIL
;; that this doesn't happen to you accidentally...
 (with-open-file (foo "no-such-file" :if-does-not-exist nil)
   (read foo))
<IMG SRC="../images/triangle.gif" BORDER=0 WIDTH=10 HEIGHT=9><U>hello?</U>
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9>  HELLO? ;This value was read from the terminal, not a file!

;; Here's another bug to avoid...
 (with-open-file (foo "no-such-file" :direction :output :if-does-not-exist nil)
   (format foo "Hello"))
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> "Hello" ;FORMAT got an argument of NIL!
</PRE>


<P ID="21">
<DT><B>Side Effects:</B><DD>

Creates a <I><A HREF="../glossary/s.htm#stream">stream</A></I> to the <I><A HREF="../glossary/f.htm#file">file</A></I> named by <I>filename</I> (upon entry),
and closes the <I><A HREF="../glossary/s.htm#stream">stream</A></I> (upon exit).
In some <I><A HREF="../glossary/i.htm#implementation">implementations</A></I>,
the <I><A HREF="../glossary/f.htm#file">file</A></I> might be locked in some way while it is open.
If the <I><A HREF="../glossary/s.htm#stream">stream</A></I> is an <I><A HREF="../glossary/o.htm#output">output</A></I> <I><A HREF="../glossary/s.htm#stream">stream</A></I>,
a <I><A HREF="../glossary/f.htm#file">file</A></I> might be created.

<P ID="22">
<DT><B>Affected By:</B><DD>

The host computer's file system.

<P ID="23">
<DT><B>Exceptional Situations:</B><DD>


See the <I><A HREF="../glossary/f.htm#function">function</A></I> <A HREF="open.htm"><B>open</B></A>.


<P ID="24">
<DT><B>See Also:</B><DD>


<A HREF="open.htm"><B>open</B></A>,
<A HREF="close.htm"><B>close</B></A>,
<A HREF="pathname.htm"><B>pathname</B></A>,
<A HREF="logical-.htm"><B>logical-pathname</B></A>,


Section <A HREF="../subsecti/pathnam0.htm">19.1.2 Pathnames as Filenames</A>


<P ID="25">



<P ID="26">


<P ID="27">
<DT><B>Allegro CL Implementation Details:</B><DD>
 None.</DL>
</TD></TR></TABLE>
<HR NOSHADE>
<A HREF="../ansicl.htm" TARGET="_self"><IMG SRC="../images/a-top12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Home"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>

<A HREF="stream-1.htm"><IMG SRC="../images/a-lft12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Previous"></A> 
<A HREF="../section/diction3.htm" TARGET="_self"><IMG SRC="../images/a-up12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Up"></A> 
<A HREF="close.htm"><IMG SRC="../images/a-rgh12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Next"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/tableofc.htm" TARGET="_self"><IMG SRC="../images/toc.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Table of Contents"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/index.htm" TARGET="_self"><IMG SRC="../images/i16.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Index"></A>
<HR NOSHADE>

<SMALL><I><B>&#169; Franz Inc. 1998-2009</b> - File last updated 7-21-2009</I></SMALL>
</FONT>

</BODY>
</HTML>
