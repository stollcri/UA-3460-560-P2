<!doctype HTML public "-//W3O//DTD W3 HTML 3.2//EN">
<HTML>
<HEAD>

<!-- 
  Document                : destruct.htm
  representing node       : Destructuring  [ID:NO-473]
                 of class : SubSubSection  [ID:SC-5]
  Generated by SchemaText : 1.52
  From HSDL source        : ansi cl
  At                      : 09:54:34 23.07.98

  About SchemaText        : http://www.schema.de
-->

<META NAME="GENERATOR" CONTENT="SchemaText 1.40f">
<META NAME="AUTHOR" CONTENT="Franz Inc.">
<META NAME="DATE" CONTENT="23.07.98">
<META NAME="TIME" CONTENT="09:51:09">
<META NAME="VERSION" CONTENT="520">

<TITLE>Destructuring</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFFF">

<table border="0" width="100%" cellpadding="1" cellspacing="0">
  <tr>
    <td bgcolor="#00FFFF"><table border="0" cellpadding="5" cellspacing="3">
      <tr>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/contents.htm"><b>ToC</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/introduction.htm"><b>DocOverview</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/cgide.htm"><b>CGDoc</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/release-notes.htm"><b>RelNotes</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/index.htm"><b>Index</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/permuted-index.htm"><b>PermutedIndex</b></a></td>
      </tr>
    </table>
    </td>
    <td align="right"><b>Allegro CL</b>
    </td>
  </tr>
</table>

<A NAME="SubSubSectio_Destructurin_473"></A>
<FONT FACE="ARIAL,GENEVA,HELVETICA">
<A HREF="../ansicl.htm" TARGET="_self"><IMG SRC="../images/a-top12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Home"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>

<A HREF="orderofe.htm"><IMG SRC="../images/a-lft12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Previous"></A> 
<A HREF="../subsecti/overvie0.htm" TARGET="_self"><IMG SRC="../images/a-up12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Up"></A> 
<A HREF="restric2.htm"><IMG SRC="../images/a-rgh12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Next"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/tableofc.htm" TARGET="_self"><IMG SRC="../images/toc.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Table of Contents"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/index.htm" TARGET="_self"><IMG SRC="../images/i16.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Index"></A>
<HR NOSHADE>
<TABLE WIDTH="90%"><TR>
<TD WIDTH=5%>&nbsp;</TD>
<TD WIDTH=95%>
<FONT SIZE=-2>
<A HREF="../ansicl.htm"> ANSI Common Lisp</A>&nbsp;&nbsp;<IMG SRC="../images/a-rgh6b.gif" BORDER=0 WIDTH=6 HEIGHT=6>&nbsp;<A HREF="../chapter/iteratio.htm">6 Iteration</A>&nbsp;&nbsp;<IMG SRC="../images/a-rgh6b.gif" BORDER=0 WIDTH=6 HEIGHT=6>&nbsp;<A HREF="../section/theloopf.htm">6.1 The LOOP Facility</A>&nbsp;&nbsp;<IMG SRC="../images/a-rgh6b.gif" BORDER=0 WIDTH=6 HEIGHT=6>&nbsp;<A HREF="../subsecti/overvie0.htm">6.1.1 Overview of the Loop Facility</A>

</FONT>
<H3 ID="2">6.1.1.7   Destructuring</H3>

The <I>d-type-spec</I> argument is used for destructuring.
If the
<I>d-type-spec</I> argument consists solely of the <I><A HREF="../glossary/t.htm#type">type</A></I> <A HREF="../dictentr/fixnum.htm"><B>fixnum</B></A>,
<A HREF="../dictentr/float.htm"><B>float</B></A>, <A HREF="../dictentr/t.htm"><B>t</B></A>, or <A HREF="../dictentr/nil.htm"><B>nil</B></A>, the <TT>of-type</TT> keyword is optional.
The <TT>of-type</TT> construct is optional in these cases to provide backwards
compatibility; thus, the following two expressions are the same:

<P ID="3">

<PRE ID="4">
;;; This expression uses the old syntax for type specifiers.
 (loop for i fixnum upfrom 3 ...)
 
;;; This expression uses the new syntax for type specifiers.
 (loop for i of-type fixnum upfrom 3 ...)

;; Declare X and Y to be of type VECTOR and FIXNUM respectively.
 (loop for (x y) of-type (vector fixnum) 
       in l do ...)
</PRE>

<P ID="5">
A <I><A HREF="../glossary/t.htm#typespecifier">type specifier</A></I> for a destructuring pattern is a <I><A HREF="../glossary/t.htm#tree">tree</A></I> of 
<I><A HREF="../glossary/t.htm#typespecifier">type specifiers</A></I> with the same shape as the <I><A HREF="../glossary/t.htm#tree">tree</A></I> of
<I><A HREF="../glossary/v.htm#variable">variable</A></I> <I><A HREF="../glossary/n.htm#name">names</A></I>, with the following exceptions:

<P ID="6">
<UL> 
<LI ID="7">
When aligning the <I><A HREF="../glossary/t.htm#tree">trees</A></I>, an <I><A HREF="../glossary/a.htm#atom">atom</A></I> in the
<I><A HREF="../glossary/t.htm#tree">tree</A></I> of <I><A HREF="../glossary/t.htm#typespecifier">type specifiers</A></I> that matches a <I><A HREF="../glossary/c.htm#cons">cons</A></I> 
in the variable tree declares the same <I><A HREF="../glossary/t.htm#type">type</A></I> for each variable
in the subtree rooted at the <I><A HREF="../glossary/c.htm#cons">cons</A></I>.

<P ID="8">
<LI ID="9"> 
A <I><A HREF="../glossary/c.htm#cons">cons</A></I> in the <I><A HREF="../glossary/t.htm#tree">tree</A></I> of <I><A HREF="../glossary/t.htm#typespecifier">type specifiers</A></I> that 
matches an <I><A HREF="../glossary/a.htm#atom">atom</A></I> in the <I><A HREF="../glossary/t.htm#tree">tree</A></I> of <I><A HREF="../glossary/v.htm#variable">variable</A></I> <I><A HREF="../glossary/n.htm#name">names</A></I>
is a <I>compound type specifer</I>.

</UL>

<P ID="10">
Destructuring allows <I><A HREF="../glossary/b.htm#binding">binding</A></I> of a set of variables to a corresponding
set of values anywhere that a value can normally be bound to a single
variable.  During <A HREF="../dictentr/loop.htm"><B>loop</B></A> expansion, 
each variable in the variable list
is matched with the values in the values list.  If there are more variables
in the variable list than there are values in the values list, the 
remaining variables are given a value of <A HREF="../dictentr/nil.htm"><B>nil</B></A>.  If there are more
values than variables listed, the extra values are discarded.

<P ID="11">
 
To assign values from a list to the variables <TT>a</TT>,
<TT>b</TT>, and <TT>c</TT>, the <TT>for</TT> clause could be used to
bind the variable <TT>numlist</TT> to the 
<I><A HREF="../glossary/c.htm#car">car</A></I> of the supplied <I>form</I>,
and then another <TT>for</TT> clause could be used to bind the variables
<TT>a</TT>, <TT>b</TT>, and <TT>c</TT> <I><A HREF="../glossary/s.htm#sequentially">sequentially</A></I>.  

<P ID="12">

<PRE ID="13">
;; Collect values by using FOR constructs.
 (loop for numlist in '((1 2 4.0) (5 6 8.3) (8 9 10.4))
       for a of-type integer = (first numlist)
       and b of-type integer = (second numlist)
       and c of-type float = (third numlist)
       collect (list c b a))
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> ((4.0 2 1) (8.3 6 5) (10.4 9 8))
</PRE>


<P ID="14">
Destructuring makes this process easier by allowing the variables to
be bound in each loop iteration.  
<I><A HREF="../glossary/t.htm#type">Types</A></I> can be declared by using a 
list of <I>type-spec</I> arguments.  If 
all the <I><A HREF="../glossary/t.htm#type">types</A></I>
are the same, a shorthand destructuring syntax can be used, as the second
example illustrates.

<P ID="15">
<PRE ID="16">
;; Destructuring simplifies the process.
 (loop for (a b c) of-type (integer integer float) in
       '((1 2 4.0) (5 6 8.3) (8 9 10.4))
       collect (list c b a))
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> ((4.0 2 1) (8.3 6 5) (10.4 9 8))
 

;; If all the types are the same, this way is even simpler.
 (loop for (a b c) of-type float in
       '((1.0 2.0 4.0) (5.0 6.0 8.3) (8.0 9.0 10.4))
       collect (list c b a))
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> ((4.0 2.0 1.0) (8.3 6.0 5.0) (10.4 9.0 8.0))
</PRE>

<P ID="17">
If destructuring is used to declare or initialize a number of groups
of variables into <I><A HREF="../glossary/t.htm#type">types</A></I>, the <I><A HREF="../glossary/l.htm#loopkeyword">loop keyword</A></I> <TT>and</TT> can be used
to simplify the process further.
 
<PRE ID="18">
;; Initialize and declare variables in parallel by using the AND construct.
 (loop with (a b) of-type float = '(1.0 2.0)
       and (c d) of-type integer = '(3 4)
       and (e f)
       return (list a b c d e f))
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> (1.0 2.0 3 4 NIL NIL)
</PRE>
 

<P ID="19">
 
If <A HREF="../dictentr/nil.htm"><B>nil</B></A>&nbsp;is used in a destructuring list, no variable is provided for
its place.

<P ID="20">
<PRE ID="21">
 (loop for (a nil b) = '(1 2 3)
       do (return (list a b)))
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> (1 3)
</PRE>

<P ID="22">
Note that 


<I><A HREF="../glossary/d.htm#dottedlist">dotted lists</A></I>
can specify destructuring.

<P ID="23">
<PRE ID="24">
 (loop for (x . y) = '(1 . 2)
       do (return y))
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> 2
 (loop for ((a . b) (c . d)) of-type ((float . float) (integer . integer)) in
       '(((1.2 . 2.4) (3 . 4)) ((3.4 . 4.6) (5 . 6)))
       collect (list a b c d))
<IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> ((1.2 2.4 3 4) (3.4 4.6 5 6))
</PRE>

<P ID="25">
An error of <I><A HREF="../glossary/t.htm#type">type</A></I> <A HREF="../dictentr/program-.htm"><B>program-error</B></A> is signaled (at macro expansion time)
if the same variable is bound twice in any variable-binding
clause of a single <A HREF="../dictentr/loop.htm"><B>loop</B></A> expression.  Such variables include
local variables, iteration control variables, and variables found by
destructuring.


</TD></TR></TABLE>
<HR NOSHADE>
<A HREF="../ansicl.htm" TARGET="_self"><IMG SRC="../images/a-top12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Home"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>

<A HREF="orderofe.htm"><IMG SRC="../images/a-lft12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Previous"></A> 
<A HREF="../subsecti/overvie0.htm" TARGET="_self"><IMG SRC="../images/a-up12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Up"></A> 
<A HREF="restric2.htm"><IMG SRC="../images/a-rgh12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Next"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/tableofc.htm" TARGET="_self"><IMG SRC="../images/toc.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Table of Contents"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/index.htm" TARGET="_self"><IMG SRC="../images/i16.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Index"></A>
<HR NOSHADE>

<SMALL><I><B>&#169; Franz Inc. 1998-2009</b> - File last updated 7-21-2009</I></SMALL>
</FONT>

</BODY>
</HTML>
