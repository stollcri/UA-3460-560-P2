<!doctype HTML public "-//W3O//DTD W3 HTML 3.2//EN">
<HTML>
<HEAD>

<!-- 
  Document                : function.htm
  representing node       : Function Call Forms as Places  [ID:NO-376]
                 of class : SubSubSection  [ID:SC-5]
  Generated by SchemaText : 1.52
  From HSDL source        : ansi cl
  At                      : 09:54:54 23.07.98

  About SchemaText        : http://www.schema.de
-->

<META NAME="GENERATOR" CONTENT="SchemaText 1.40f">
<META NAME="AUTHOR" CONTENT="Franz Inc.">
<META NAME="DATE" CONTENT="23.07.98">
<META NAME="TIME" CONTENT="09:51:09">
<META NAME="VERSION" CONTENT="520">

<TITLE>Function Call Forms as Places</TITLE>
</HEAD>

<BODY BGCOLOR="#FFFFFF">

<table border="0" width="100%" cellpadding="1" cellspacing="0">
  <tr>
    <td bgcolor="#00FFFF"><table border="0" cellpadding="5" cellspacing="3">
      <tr>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/contents.htm"><b>ToC</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/introduction.htm"><b>DocOverview</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/cgide.htm"><b>CGDoc</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/release-notes.htm"><b>RelNotes</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/index.htm"><b>Index</b></a></td>
        <td align="left" bgcolor="#00FFFF"><a href="../../doc/permuted-index.htm"><b>PermutedIndex</b></a></td>
      </tr>
    </table>
    </td>
    <td align="right"><b>Allegro CL</b>
    </td>
  </tr>
</table>

<A NAME="SubSubSectio_Function_Cal_376"></A>
<FONT FACE="ARIAL,GENEVA,HELVETICA">
<A HREF="../ansicl.htm" TARGET="_self"><IMG SRC="../images/a-top12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Home"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>

<A HREF="variable.htm"><IMG SRC="../images/a-lft12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Previous"></A> 
<A HREF="../subsecti/kindsofp.htm" TARGET="_self"><IMG SRC="../images/a-up12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Up"></A> 
<A HREF="valuesfo.htm"><IMG SRC="../images/a-rgh12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Next"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/tableofc.htm" TARGET="_self"><IMG SRC="../images/toc.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Table of Contents"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/index.htm" TARGET="_self"><IMG SRC="../images/i16.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Index"></A>
<HR NOSHADE>
<TABLE WIDTH="90%"><TR>
<TD WIDTH=5%>&nbsp;</TD>
<TD WIDTH=95%>
<FONT SIZE=-2>
<A HREF="../ansicl.htm"> ANSI Common Lisp</A>&nbsp;&nbsp;<IMG SRC="../images/a-rgh6b.gif" BORDER=0 WIDTH=6 HEIGHT=6>&nbsp;<A HREF="../chapter/dataandc.htm">5 Data and Control Flow</A>&nbsp;&nbsp;<IMG SRC="../images/a-rgh6b.gif" BORDER=0 WIDTH=6 HEIGHT=6>&nbsp;<A HREF="../section/generali.htm">5.1 Generalized Reference</A>&nbsp;&nbsp;<IMG SRC="../images/a-rgh6b.gif" BORDER=0 WIDTH=6 HEIGHT=6>&nbsp;<A HREF="../subsecti/kindsofp.htm">5.1.2 Kinds of Places</A>

</FONT>
<H3 ID="2">5.1.2.2   Function Call Forms as Places</H3>

A <I><A HREF="../glossary/f.htm#functionform">function form</A></I> can be used as a <I><A HREF="../glossary/p.htm#place">place</A></I> if it falls
into one of the following categories:

<P ID="3">
<UL>

<P ID="4">
<LI ID="5">
A function call form whose first element is the name of
any one of the functions in the next figure.


<P ID="6">




<P ID="7">



<P ID="8">
<TABLE WIDTH="100%" BORDER=1 CELLSPACING=0 CELLPADDING=5>
<CAPTION ALIGN=BOTTOM>Functions that setf can be used with<cl_emdash>1</CAPTION>

  <tr>
    <td>aref</td>
    <td>cdadr</td>
    <td>get</td>
  </tr>
  <tr>
    <td>bit</td>
    <td>cdar</td>
    <td>gethash</td>
  </tr>
  <tr>
    <td>caaaar</td>
    <td>cddaar</td>
    <td>logical-pathname-translations</td>
  </tr>
  <tr>
    <td>caaadr</td>
    <td>cddadr</td>
    <td>macro-function</td>
  </tr>
  <tr>
    <td>caaar</td>
    <td>cddar</td>
    <td>ninth</td>
  </tr>
  <tr>
    <td>caadar</td>
    <td>cdddar</td>
    <td>nth</td>
  </tr>
  <tr>
    <td>caaddr</td>
    <td>cddddr</td>
    <td>readtable-case</td>
  </tr>
  <tr>
    <td>caadr</td>
    <td>cdddr</td>
    <td>rest</td>
  </tr>
  <tr>
    <td>caar</td>
    <td>cddr</td>
    <td>row-major-aref</td>
  </tr>
  <tr>
    <td>cadaar</td>
    <td>cdr</td>
    <td>sbit</td>
  </tr>
  <tr>
    <td>cadadr</td>
    <td>char</td>
    <td>schar</td>
  </tr>
  <tr>
    <td>cadar</td>
    <td>class-name</td>
    <td>second</td>
  </tr>
  <tr>
    <td>caddar</td>
    <td>compiler-macro-function</td>
    <td>seventh</td>
  </tr>
  <tr>
    <td>cadddr</td>
    <td>documentation</td>
    <td>sixth</td>
  </tr>
  <tr>
    <td>caddr</td>
    <td>eighth</td>
    <td>slot-value</td>
  </tr>
  <tr>
    <td>cadr</td>
    <td>elt</td>
    <td>subseq</td>
  </tr>
  <tr>
    <td>car</td>
    <td>fdefinition</td>
    <td>svref</td>
  </tr>
  <tr>
    <td>cdaaar</td>
    <td>fifth</td>
    <td>symbol-function</td>
  </tr>
  <tr>
    <td>cdaadr</td>
    <td>fill-pointer</td>
    <td>symbol-plist</td>
  </tr>
  <tr>
    <td>cdaar</td>
    <td>find-class</td>
    <td>symbol-value</td>
  </tr>
  <tr>
    <td>cdadar</td>
    <td>first</td>
    <td>tenth</td>
  </tr>
  <tr>
    <td>cdaddr</td>
    <td>fourth</td>
    <td>third</td>
  </tr>
</TABLE>






<P ID="9">

In the case of <A HREF="../dictentr/subseq.htm"><B>subseq</B></A>, the replacement value must be a <I><A HREF="../glossary/s.htm#sequence">sequence</A></I>
whose elements might be contained by the sequence argument to <A HREF="../dictentr/subseq.htm"><B>subseq</B></A>,
but does not have to be a <I><A HREF="../glossary/s.htm#sequence">sequence</A></I> of the same <I><A HREF="../glossary/t.htm#type">type</A></I> 

as the <I><A HREF="../glossary/s.htm#sequence">sequence</A></I> of which the subsequence is specified.
If the length of the replacement value does not equal the length of
the subsequence to be replaced, then the shorter length determines
the number of elements to be stored, as for <A HREF="../dictentr/replace.htm"><B>replace</B></A>.

<P ID="10">
  
<LI ID="11">

A function call form whose first element is the name of
a selector function constructed by <A HREF="../dictentr/defstruc.htm"><B>defstruct</B></A>.



The function name must refer to the global function definition,
rather than a locally defined <I><A HREF="../glossary/f.htm#function">function</A></I>.


<P ID="12">
<LI ID="13">

A function call form whose first element is the name of
any one of the functions in the next figure, 
provided that the supplied argument
to that function is in turn a <I><A HREF="../glossary/p.htm#place">place</A></I> form;
in this case the new <I><A HREF="../glossary/p.htm#place">place</A></I> has stored back into it the
result of applying the supplied "update" function.
<P ID="14">
                        
<P ID="15">
<TABLE WIDTH="100%" BORDER=1 CELLSPACING=0 CELLPADDING=5>
<CAPTION ALIGN=BOTTOM>Functions that setf can be used with<cl_emdash>2</CAPTION>
<TR><TH ALIGN=LEFT>Function name</TH>
<TH ALIGN=LEFT>Argument that is a <I>place</I></TH>
<TH ALIGN=LEFT>Update function used</TH>
</TR>

  <tr>
    <td><A HREF="../dictentr/ldb.htm"><B>ldb</B></A></td>
    <td>second</td>
    <td><A HREF="../dictentr/dpb.htm"><B>dpb</B></A></td>
  </tr>
  <tr>
    <td><A HREF="../dictentr/mask-fie.htm"><B>mask-field</B></A></td>
    <td>second</td>
    <td><A HREF="../dictentr/deposit-.htm"><B>deposit-field</B></A></td>
  </tr>
  <tr>
    <td><A HREF="../dictentr/getf.htm"><B>getf</B></A></td>
    <td>first</td>
    <td><I><A HREF="../glossary/i.htm#implementationdependent">implementation-dependent</A></I></td>
  </tr>
</TABLE>
During the <A HREF="../dictentr/setfpset.htm"><B>setf</B></A> expansion of these <I><A HREF="../glossary/f.htm#form">forms</A></I>, it is necessary to call 

<A HREF="../dictentr/get-setf.htm"><B>get-setf-expansion</B></A> 

in order to figure out how the inner, nested generalized variable must be treated.  

<P ID="16">
The information from

<A HREF="../dictentr/get-setf.htm"><B>get-setf-expansion</B></A>

is used as follows.
<UL>
 

 
<LI ID="17"><A HREF="../dictentr/ldb.htm"><B>ldb</B></A>

<P ID="18">
In a form such as:

<P ID="19">
<TT>(setf (ldb <I>byte-spec</I> <I>place-form</I>) <I>value-form</I>)</TT>

<P ID="20">
the place referred to by the <I>place-form</I> must always be both <I><A HREF="../glossary/r.htm#read">read</A></I> 
and <I>written</I>;  note that the update is to the generalized variable 
specified by <I>place-form</I>, not to any object of <I><A HREF="../glossary/t.htm#type">type</A></I> <A HREF="../dictentr/integer.htm"><B>integer</B></A>.

<P ID="21">
Thus this <A HREF="../dictentr/setfpset.htm"><B>setf</B></A> should generate code to do the following:

<P ID="22">
<UL>
<LI ID="23">1. Evaluate <I>byte-spec</I> (and bind it into a temporary variable).
<LI ID="24">2. Bind the temporary variables for <I>place-form</I>.
<LI ID="25">3. Evaluate <I>value-form</I>  (and bind 

its value or values into the store variable).



<LI ID="26">4. Do the <I><A HREF="../glossary/r.htm#read">read</A></I> from <I>place-form</I>.
<LI ID="27">5. Do the <I><A HREF="../glossary/w.htm#write">write</A></I> into <I>place-form</I> with 
the given bits of the <I><A HREF="../glossary/i.htm#integer">integer</A></I>
       fetched in step 4 replaced with the value from step 3.
</UL> 
    If the evaluation of <I>value-form</I> 


in step 3 alters what is found in <I>place-form</I>,
such as setting different bits of <I><A HREF="../glossary/i.htm#integer">integer</A></I>,
    then the change of the bits denoted by 
<I>byte-spec</I> is to that 
    altered <I><A HREF="../glossary/i.htm#integer">integer</A></I>, 
because step 4 is done after the <I>value-form</I>
    evaluation.  Nevertheless, the 
    evaluations required for <I><A HREF="../glossary/b.htm#binding">binding</A></I> 
the temporary variables are done in steps 1 and 
    2, and thus the expected left-to-right evaluation order is seen.
For example:

<P ID="28">
<PRE ID="29">
 (setq integer #x69) <IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> #x69
 (rotatef (ldb (byte 4 4) integer) 
          (ldb (byte 4 0) integer))
 integer <IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> #x96
;;; This example is trying to swap two independent bit fields 
;;; in an integer.  Note that the generalized variable of 
;;; interest here is just the (possibly local) program variable
;;; integer.
</PRE>

<P ID="30">
<LI ID="31"><A HREF="../dictentr/mask-fie.htm"><B>mask-field</B></A>

<P ID="32">
   This case is the same as <A HREF="../dictentr/ldb.htm"><B>ldb</B></A> in all essential aspects.

<P ID="33">
<LI ID="34"><A HREF="../dictentr/getf.htm"><B>getf</B></A>

<P ID="35">
    In a form such as:

<P ID="36">
<TT>(setf (getf <I>place-form</I> <I>ind-form</I>) <I>value-form</I>)</TT>

<P ID="37">
    the place referred to by <I>place-form</I> must always be both <I><A HREF="../glossary/r.htm#read">read</A></I>
    and <I>written</I>;  note that the update is to the generalized variable 
    specified by <I>place-form</I>, not necessarily to the particular 
<I><A HREF="../glossary/l.htm#list">list</A></I>
that is the property list in question.

<P ID="38">
    Thus this <A HREF="../dictentr/setfpset.htm"><B>setf</B></A> should generate code to do the following:
<UL>
<LI ID="39">1. 
Bind the temporary variables for <I>place-form</I>.
<LI ID="40">2. 
Evaluate <I>ind-form</I> (and bind it into a temporary variable).
<LI ID="41">3. 
Evaluate <I>value-form</I> (and bind 

its value or values into the store variable).



<LI ID="42">4. 
Do the <I><A HREF="../glossary/r.htm#read">read</A></I> from <I>place-form</I>.
<LI ID="43">5. 
Do the <I><A HREF="../glossary/w.htm#write">write</A></I> into <I>place-form</I> with a possibly-new property list
       obtained by combining the values from steps 2, 3, and 4.  
(Note that the phrase "possibly-new property list" can mean that 
    the former property list is somehow destructively re-used, or it can 
    mean partial or full copying of it.  
Since either copying or destructive re-use can occur, 
the treatment of the resultant value for the 
    possibly-new property list must proceed as if it were a different copy
    needing to be stored back into the generalized variable.)
</UL> 
    If the evaluation of <I>value-form</I> 
in step 3 alters what is found in
<I>place-form</I>, such as setting a different named property in the list,
    then the change of the property denoted by <I>ind-form</I> 
is to that 
    altered list, because step 4 is done after the 
<I>value-form</I>
    evaluation.  Nevertheless, the 
    evaluations required for <I><A HREF="../glossary/b.htm#binding">binding</A></I> 
the temporary variables  are done in steps 1 and 
    2,  and thus the expected left-to-right evaluation order is seen.

<P ID="44">
For example:

<P ID="45">
<PRE ID="46">
 (setq s (setq r (list (list 'a 1 'b 2 'c 3)))) <IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> ((a 1 b 2 c 3))
 (setf (getf (car r) 'b) 
       (progn (setq r nil) 6)) <IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> 6
 r <IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9>  NIL
 s <IMG SRC="../images/rightarr.gif" BORDER=0 WIDTH=14 HEIGHT=9> ((A 1 B 6 C 3))
;;; Note that the (setq r nil) does not affect the actions of 
;;; the SETF because the value of R had already been saved in 
;;; a temporary variable as part of the step 1. Only the CAR
;;; of this value will be retrieved, and subsequently modified 
;;; after the value computation.
</PRE>

</UL>
</UL>

<P ID="47">
                        



<P ID="48">


</TD></TR></TABLE>
<HR NOSHADE>
<A HREF="../ansicl.htm" TARGET="_self"><IMG SRC="../images/a-top12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Home"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>

<A HREF="variable.htm"><IMG SRC="../images/a-lft12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Previous"></A> 
<A HREF="../subsecti/kindsofp.htm" TARGET="_self"><IMG SRC="../images/a-up12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Up"></A> 
<A HREF="valuesfo.htm"><IMG SRC="../images/a-rgh12b.gif" BORDER=0 WIDTH=12 HEIGHT=12 ALT="Next"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/tableofc.htm" TARGET="_self"><IMG SRC="../images/toc.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Table of Contents"></A><IMG SRC="../images/void16.gif" BORDER=0 WIDTH=16 HEIGHT=16>
<A HREF="../meta/index.htm" TARGET="_self"><IMG SRC="../images/i16.gif" BORDER=0 WIDTH=16 HEIGHT=16 ALT="Index"></A>
<HR NOSHADE>

<SMALL><I><B>&#169; Franz Inc. 1998-2009</b> - File last updated 7-21-2009</I></SMALL>
</FONT>

</BODY>
</HTML>
