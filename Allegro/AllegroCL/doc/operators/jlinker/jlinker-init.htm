<html><head><meta http-equiv="content-type" name="description" content="text/html; charset=UTF-8"> <title>jlinker-init</title><link rel="stylesheet" href="../../acldoc-styles.css" type="text/css"></head><body><table border="0" width="100%" cellpadding="1" cellspacing="0"><tr><td colspan="2" bgcolor="#00FFFF"><table border="0" cellpadding="5" cellspacing="3"><tr><td align="left" bgcolor="#00FFFF"><b>Function</b></td><td align="left" bgcolor="#00FFFF"><b>Package: javatools.jlinker</b></td><td align="center" bgcolor="#00FFFF"><a href="../../contents.htm"><b>ToC</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../introduction.htm"><b>DocOverview</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../cgide.htm"><b>CGDoc</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../release-notes.htm"><b>RelNotes</b></a></td><td align="center" bgcolor="#00FFFF"><a href="http://www.franz.com/support/faqs/"><b>FAQ</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../index.htm"><b>Index</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../permuted-index.htm"><b>PermutedIndex</b></a></td></tr></table></td><td align="right"><b>Allegro CL version 8.2</b><br><small><a href="../../introduction.htm#updates-s">Unrevised from 8.1 to 8.2.</a></small><br><a href="http://www.franz.com/support/documentation/8.1/doc/operators/jlinker/jlinker-init.htm">8.1 version</a></td></tr></table><h2 id="2">jlinker-init</h2>




<p id="3"><b>Arguments: </b><i>
</i> &amp;optional <i>mode</i><i>
</i>&amp;key <i>lisp-port lisp-host lisp-file java-port java-host java-file local-dist timeout java-args preload debug verbose error-p library java-home classpath jar report</i><i>
</i></p>

<p id="4">
This function initializes a connection between Lisp and Java.  The
argument list supplied is combined with the value of <a href="../../variables/jlinker/s_jlinker-init_s.htm"><code>*jlinker-init*</code></a> in
order to form the actual initialization arguments. Supplied arguments
override any items in the value of <a href="../../variables/jlinker/s_jlinker-init_s.htm"><code>*jlinker-init*</code></a>.
</p>

<h3 id="5">
The mode argument
</h3>
<p id="6">
The optional <i>mode</i> argument may be one of the
following keywords (keywords in a single bullet are synonyms).
</p>
<ul>
<li id="7">
<b>:start</b> or <b>:start-java</b> (the default)
</li>
<li id="8">
<b>:lisp-advertises</b>
</li>
<li id="9">
<b>:java-advertises</b>
</li>
<li id="10">
<b>:native</b> or <b>:jni</b>
</li>
</ul>

<p id="11">
The mode argument specifies the way in which Lisp and Java will
communicate.  If the mode is not specified or is <code>nil</code>, the default <b>:start-java</b> mode is used.
You must specify a mode if you wish to supply values for any keyword
argument.
</p>

<p id="12">
When <i>mode</i> is <b>:start</b> (or the synonym
<b>:start-java</b>), the Lisp process starts a new Java VM in a
separate operating system process. See <a href="#start-java-mode">here
below</a> for more details.
</p>
<p id="13">
When <i>mode</i> is <b>:lisp-advertises</b>, the Lisp
process waits for a separate Java application to make contact. See <a href="#lisp-advertises-mode">here below</a> for more details.
</p>
<p id="14">
When <i>mode</i> is <b>:java-advertises</b>, the Lisp
process attempts to connect to a separate Java process. See <a href="#java-advertises-mode">here below</a> for more details.
</p>
<p id="15">
In all the above cases, the Lisp and Java parts of the application reside
in separate address spaces, and communication takes place through sockets.
</p>
<p id="16">
When <i>mode</i> is <b>:native</b> (or the synonym
<b>:jni</b>), the Java VM is loaded into the address space of the Lisp
process.  The Lisp and Java parts of the application share one address
space and one operating system process.  Communication takes place
through foreign calls. See <a href="#native-mode">here below</a> for
more details.
</p>
<p id="17">
At the application level, there is no difference between the socket
(all except <b>:native</b>/<b>:jni</b>) and foreign call
(<b>:native</b>/<b>:jni</b>) modes. The mode selection only affects
how the interface is initialized.
</p>
<h3 id="18">
jlinker-init return value
</h3>
<p id="19">
If jlinker is not initialized and the call to <a href="jlinker-init.htm"><b>jlinker-init</b></a> succeeds, the return
value is the keyword <b>:jlinker-init</b>.
</p>
<p id="20">
If jlinker is not initialized and the call to <a href="jlinker-init.htm"><b>jlinker-init</b></a>, the result
(returning a value or signaling an error) depends on the
<i>error-p</i> argument, as describes in the discussion
of arguments below.
</p>
<p id="21">
It is not an error to call <a href="jlinker-init.htm"><b>jlinker-init</b></a> when jlinker is
already initialized. In that case the function ignores any arguments
supplied and simply returns a keyword indicating the type of
connection, based on the mode in which it was started:
</p>
<ul>
<li id="22">
if the socket implementation is running (jlinker was started with
<i>mode</i> is anything other than <b>:native</b> or
<b>:jni</b>), then the return value is <b>:socket</b>.
</li>
<li id="23">
if the native implementation is running (jlinker was started with
<i>mode</i> is <b>:native</b> or <b>:jni</b>), then the
return value is <b>:native</b>.
</li>
</ul>

<h3 id="24">
jlinker-init keyword arguments
</h3>

<p id="25">
The meaning of many keyword arguments to <a href="jlinker-init.htm"><b>jlinker-init</b></a> is determined by the
mode but the following keyword arguments have a common meaning:
</p>

<table border="1" width="95%">
<tr>
<td width="30%"><strong>Keyword argument</strong></td>
<td width="30%"><strong>Default value</strong></td>
<td width="40%"><strong>Comment</strong></td>
</tr>
<tr>
<td width="30%">
<code>:error-p</code>
</td>
<td width="30%">
The value of <a href="../../variables/jlinker/s_jlinker-error-p_s.htm"><code>*jlinker-error-p*</code></a>. Note starting
in version 8.0, the initial value of <a href="../../variables/jlinker/s_jlinker-error-p_s.htm"><code>*jlinker-error-p*</code></a> is <code>t</code>. In earlier releases the initial value was <code>nil</code>.
</td>
<td width="40%">
When this argument is non-<code>nil</code>, errors
detected by <a href="jlinker-init.htm"><b>jlinker-init</b></a> are signaled as Lisp
errors. When this argument is <code>nil</code>, <a href="jlinker-init.htm"><b>jlinker-init</b></a> does not
signal errors; if errors are detected, the value returned is a list of
tokens that describe the error; if the operation succeeds, the value
is the symbol <b>:jlinker-init</b>.
</td>
</tr>
<tr>
<td width="30%"><code>:verbose</code>
</td>
<td width="30%">
<code>nil</code>
</td>
<td width="40%">
When this argument is non-<code>nil</code>, jlinker prints
progress messages. The content of the messages depends on the
<i>mode</i> argument.
</td>
</tr>
<tr>
<td width="30%">
<code>:debug</code>
</td>
<td width="30%">
The default is the value of <a href="../../variables/jlinker/s_jlinker-debug_s.htm"><code>*jlinker-debug*</code></a>.
</td>
<td width="40%">
If this argument is non-<code>nil</code>, the Java VM
prints progress and status messages to the <b>java.lang.System.out</b>
stream.
</td>
</tr>
<tr>
<td width="30%">
<code>:java-home</code>
</td>
<td width="30%">
The default is taken from the special variable <a href="../../variables/jlinker/s_jlinker-java-home_s.htm"><code>*jlinker-java-home*</code></a>.
</td>
<td width="40%">
This argument specifies the directory where the Java executable may be
found. Jlinker looks in the <i>bin/</i> sub-directory for a Java
executable. If the value is <code>nil</code>, then we
assume that the Java executable will be found by the operating system
if it is simply mentioned by name (ie, on Unix systems, it may be
found on the default PATH). Otherwise, the value must be a suitable
directory. If the value is :find (MS Windows only), the Windows
registry is examined to find the Java location.
</td>
</tr>
<tr>
<td width="30%"><code>:classpath</code> and
<code>:jar</code>
</td>
<td width="30%">
<code>nil</code> (for both)
</td>
<td width="40%">
These arguments specify how the Java classpath should be modified (in
those cases where a modification is relevant). See <a href="#classpath-jar-args">below</a> for more
information.
</td>
</tr>
<tr>
<td width="30%">
<code>:lisp-port</code>
</td>
<td width="30%">
If unspecified, the system asks the OS to assign a port number, and this 
default is normally sufficient.
</td>
<td width="40%">
This argument specifies the socket port used by Lisp to communicate
with Java. The default is to ask the OS to assign a port number, and
this default is normally sufficient. If a value is specified, it must
be a positive number greater than zero, and the given port number must
be available.
</td>
</tr>
<tr>
<td width="30%">
<code>:java-port</code>
</td>
<td width="30%">
If unspecified, the system asks the OS to assign a port number, and
this default is normally sufficient.
</td>
<td width="40%">
This argument specifies the socket port used by Java to communicate
with Lisp. If the specified value is greater than zero, than Java
listens at that port number and Lisp connects. 
<br>
If the specified value
is less than zero, the absolute value is a port number. Lisp listens
at the port and Java connects; this option is useful when the Java
application is unable to listen at a socket port.
<br>

If a value is specified, its absolute value must be greater than zero
and identify an available post.
</td>
</tr>
<tr>
<td width="30%">
<code>:local-dist</code>
</td>
<td width="30%">
The default value is "Lisp".
</td>
<td width="40%">
This argument specifies an alternate label for the Lisp
server in a jlinker connection. If multiple copies of jlinker
are running in the same image, this may help in some debugging
situations. 
</td>
</tr>
<tr>
<td width="30%">
<code>:preload</code>
</td>
<td width="30%">
<code>nil</code>
</td>
<td width="40%">
This argument specifies a file that is loaded during the initalization
of a socket connection. The file is generated by a call of the form
<code>(jlookup :gen-preload [filename])</code> (see <a href="jlookup.htm"><b>jlookup</b></a>).
</td>
</tr>
<tr>
<td width="30%">
<code>:report</code>
</td>
<td width="30%">
<code>nil</code>
</td>
<td width="40%">
This argument is in effect in modes
<code>:start-java</code> and
<code>:lisp-advertises</code>. If specified, this argument must
be a function of one argument. The function is called as soon as a
listening socket is created. The argument is the port number of the
listening socket.
</td>
</tr>
</table>

<h3 id="26">
<a name="classpath-jar-args"></a>The classpath and jar keyword arguments
</h3> 

<p id="27">
If either argument is
specified, then the Java classpath value is the concatenation of the
following three values:
</p>
<ol>
<li id="28">
The <i>classpath</i> argument: A string is used
verbatim; A list (of strings) is concatenated into a string where the
list elements are separated by the classpath separator; <code>nil</code> or no value specified means use the string ".".
</li>
<li id="29">
The current value of the CLASSPATH environment variable.
</li>
<li id="30">
The resolved jar file path. This file must be visible to the Java VM
for the correct operation of the jlinker interface. 
</li>
</ol>
<p id="31">
If a <i>jar</i> argument was specified, it is used as
the resolved jar file path. Otherwise a default resolved jar file
path is determined in 2 steps:
</p>
<ol>
<li id="32">
If a file "jlinker.jar" exists in the current directory, it is the default.
</li>
<li id="33">
If the file with logical pathname "sys:jlinker;jlinker.jar" exists, it
is the default.
</li>
</ol>

<p id="34">
If the value of <i>jar</i> is specified to be <code>nil</code>, then we assume that the <i>jlinker.jar</i> file
is visible to the Java VM for reasons outside our control; for
example, it may have been installed in the Java library directory
along with the built-in Java libraries. In this case, the resolved jar
file path is the empty string.
</p>
<p id="35">
If neither <i>jar</i> nor <i>classpath</i>
are given values, then the behavior is compatible with older versions
of jlinker - the behavior is determined entirely by the value of the
<a href="../../variables/jlinker/s_jlinker-java-home_s.htm"><code>*jlinker-java-home*</code></a>
variable. Jlinker adds "." and "jlinker.jar" to the classpath on the
assumption that the <i>jlinker.jar</i> file is in the current
directory.
</p>

<h3 id="36">
<a name="start-java-mode"></a>
Mode :start-java
</h3>

<p id="37">
When <i>mode</i> is <code>:start-java</code> (or
the synonym <code>:start</code>), the Lisp process starts a new
Java VM in a separate operating system process.
</p>
<p id="38">
The arguments <i>java-home</i>,
<i>classpath</i>, <i>jar</i>,
<i>java-args</i>, and <i>debug</i>
determine how the Java VM is started from the Lisp process.
</p>
<p id="39">
The <i>lisp-port</i> and <i>java-port</i>
arguments may be specified if the default is not sufficient. The
arguments <i>library</i>, <i>load</i>,
<i>lisp-file</i>, and <i>java-file</i> are
ignored.  The arguments <i>lisp-host</i>, and
<i>java-host</i> should not be specified.
</p>
<p id="40">
The <b><i>debug</i></b> argument: on Microsoft Windows,
the <i>debug</i> argument also determines the Java
executable. If <i>debug</i> is <code>nil</code>, we use the executable "javaw.exe"; if debug is
non-<code>nil</code>, we use the executable "java.exe"
which opens a console window where Java output may be seen.
</p>
<p id="41">
The <b><i>java-args</i></b> argument: the value should
be a list of string arguments passed to Java.These are added after the
ones passed by jLinker. If the first item in this list is a sub-list
starting with the keyword <code>:options</code>, then the
remainder of the sub-list is passed to Java in front of any options
passed by jLinker.
</p>

<h3 id="42">
<a name="lisp-advertises-mode"></a>
Mode :lisp-advertises
</h3>

<p id="43">
When <i>mode</i> is <code>:lisp-advertises</code>,
the Lisp process waits for a separate Java application to make
contact.  The Java application uses the LispConnector class to make
the connection.
</p>
<p id="44">
The <b><i>lisp-file</i></b> argument: this argument
specifies a file in which Lisp advertises the host and port where Java
must connect. The default is "JavaToLisp.trp". If this argument is
<code>nil</code>, Lisp simply listens at the specified
port and does not advertise in a file. In that case it is necessary to
specify <i>lisp-port</i> as a non-zero value.
</p>
<p id="45">
The <b><i>lisp-host</i></b> argument: this argument is
used when the file specified by the <i>lisp-file</i>
argument is written. The Java application needs to know the lisp-host
value if it is running on a different host. The default value is
"localhost".
</p>
<p id="46">
The <b><i>timeout</i></b> argument: if non-<code>nil</code>, this argument specifies the number of seconds
Lisp will wait for a connection from Java.
</p>
<h3 id="47">
<a name="java-advertises-mode"></a>
Mode :java-advertises
</h3>

<h3 id="48">
<a name="lisp-advertises-mode"></a>
Mode :java-advertises
</h3>

<p id="49">
When <i>mode</i> is <code>:java-advertises</code>,
the Lisp process attempts to connect to a separate Java process.  The
Java application uses the LispConnector class to make the connection.
</p>
<p id="50">
The <b><i>java-file</i></b> argument: this argument
specifies a file in which Java advertises the host and port where Lisp
must connect. The default is "LispToJava.trp". If this argument is
<code>nil</code>, Java is assumed to listen at the
specified port and does not advertise in a file.
</p>
<p id="51">
The <b><i>java-host</i></b> argument: this argument must
specifiy the host where Java is advertising when
<i>java-file</i> is <code>nil</code>. The
default value is "localhost".
</p>
<p id="52">
The <b><i>java-port</i></b> argument: this argument must
specifiy the port where Java is advertising when
<i>java-file</i> is <code>nil</code>. When
<i>java-file</i> is <code>nil</code>, this
argument must be specified as positive number greater than zero.
</p>


<h3 id="53">
<a name="native-mode"></a>
Mode :native (new in Allegro CL 8.0)
</h3>

<p id="54">
When <i>mode</i> is <code>:native</code> (or the
synonym <code>:jni</code>), the Java VM is loaded into the
address space of the Lisp process. The Lisp and Java parts of the
application share one address space and one operating system process.
Calls between Lisp and Java are equivalent to foreign library calls
and data is transmitted in registers or in memory-to-memory copies.
</p>
<p id="55">
The arguments <i>java-home</i>,
<i>library</i>, <i>classpath</i>,
<i>jar</i>, <i>java-args</i>, and
<i>debug</i> determine how the Java VM is started from
the Lisp process.
</p>
<p id="56">
The <i>lisp-port</i>, <i>lisp-host</i>,
<i>lisp-file</i>, <i>java-port</i>,
<i>java-host</i>, <i>java-file</i>, and
<i>timeout</i> arguments are ignored.
</p>
<p id="57">
The <b><i>library</i></b> argument: this argument
specifies the pathname of the shared library where the Java VM is
implemented. The default value is taken from the special variable
<a href="../../variables/jlinker/s_jni-library_s.htm"><code>*jni-library*</code></a>.  On MS Windows,
the initial value is <code>:find</code> to specify that the
Windows Registry should be searched for the location of the Java
Library. Otherwise, the value must be a path string. A relative path
is merged with the value of the <i>java-home</i>
argument.
</p>
<p id="58">
The <b><i>java-args</i></b> argument: this argument may
be a list of strings that specify additional arguments passed to the
Java VM.  Some of these are described in the Java documentation and in
the file Xusage.txt in the Java runtime.
</p>
<p id="59">
For example, the argument "-Xmx256m" specifies 256 megabytes for the
Java heap while the argument "-Dfoo=bar" specifes the value "bar" for
the Java System.property. 
</p>
<p id="60">
The <b><i>load</i></b> argument: this argument forces a
re-load of the Java shared library.
</p>
<p id="61">
If a Lisp image is saved with <a href="../excl/dumplisp.htm"><b>dumplisp</b></a> while a jlinker native connections is
running, the saved image must re-initialize the Lisp-Java connection
when the saved image is re-started.  This is done by calling
</p>
<pre id="62">
(jlinker-init :native :load t :library "xxx" ...)
</pre>
<p id="63">
The <i>library</i> argument must be specified in this
case.
</p>




<p id="64">
See <a href="../../jlinker.htm">jlinker.htm</a> for more information on the
jLinker facility.
</p>

<hr><p id="65"><small>Copyright (c) 1998-2010, Franz Inc. Oakland, CA., USA. All rights reserved.</small><br><small>Documentation for Allegro CL version 8.2. This page was not revised from the 8.1 page.</small><br>
<small>Created 2010.1.21.</small>
<br></p><table border="0" width="100%" cellpadding="1" cellspacing="0"><tr><td colspan="2" bgcolor="#00FFFF"><table border="0" cellpadding="5" cellspacing="3"><tr><td align="left" bgcolor="#00FFFF"></td><td align="left" bgcolor="#00FFFF"></td><td align="center" bgcolor="#00FFFF"><a href="../../contents.htm"><b>ToC</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../introduction.htm"><b>DocOverview</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../cgide.htm"><b>CGDoc</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../release-notes.htm"><b>RelNotes</b></a></td><td align="center" bgcolor="#00FFFF"><a href="http://www.franz.com/support/faqs/"><b>FAQ</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../index.htm"><b>Index</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../permuted-index.htm"><b>PermutedIndex</b></a></td></tr></table></td><td align="right"><b>Allegro CL version 8.2</b><br><small><a href="../../introduction.htm#updates-s">Unrevised from 8.1 to 8.2.</a></small><br><a href="http://www.franz.com/support/documentation/8.1/doc/operators/jlinker/jlinker-init.htm">8.1 version</a></td></tr></table></body></html>