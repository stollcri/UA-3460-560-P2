<html><head><meta http-equiv="content-type" name="description" content="text/html; charset=UTF-8"> <title>lock-tables</title><link rel="stylesheet" href="../../acldoc-styles.css" type="text/css"></head><body><table border="0" width="100%" cellpadding="1" cellspacing="0"><tr><td colspan="2" bgcolor="#00FFFF"><table border="0" cellpadding="5" cellspacing="3"><tr><td align="left" bgcolor="#00FFFF"><b>Function</b></td><td align="left" bgcolor="#00FFFF"><b>Package: dbi.mysql</b></td><td align="center" bgcolor="#00FFFF"><a href="../../contents.htm"><b>ToC</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../introduction.htm"><b>DocOverview</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../cgide.htm"><b>CGDoc</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../release-notes.htm"><b>RelNotes</b></a></td><td align="center" bgcolor="#00FFFF"><a href="http://www.franz.com/support/faqs/"><b>FAQ</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../index.htm"><b>Index</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../permuted-index.htm"><b>PermutedIndex</b></a></td></tr></table></td><td align="right"><b>Allegro CL version 8.2</b><br><small><a href="../../introduction.htm#updates-s">Unrevised from 8.1 to 8.2.</a></small><br><a href="http://www.franz.com/support/documentation/8.1/doc/operators/mysql/lock-tables.htm">8.1 version</a></td></tr></table><h2 id="2">lock-tables</h2>

<p id="3"><b>Arguments: </b><i>
</i>&amp;key <i>read write db showsql</i><i>
</i></p>


<p id="4">
This function generates and executes an sql "lock tables" statement.
The <i>read</i> and <i>write</i> arguments
describe which tables are to be locked for reading and writing
respectively.
</p>
<p id="5">
The <i>db</i>, which defaults to the value of <a href="../../variables/mysql/s_mysql_s.htm"><code>*mysql*</code></a>, must be a mysql
object such as returned by <a href="connect.htm"><b>connect</b></a>.
</p>
<p id="6">
The values of the <i>read</i> and
<i>write</i> arguments can be either:
</p>
<ol>
<li id="7">
a string naming a single table
</li>
<li id="8">
a list (tablename :as alias) where tablename and alias are strings.
</li>
<li id="9">
a list of items from 1 and 2.
</li>
</ol>
<p id="10">
You can see the sql generated by specifying t as the value of
<i>showsql</i>.
</p>

<pre id="11">
cl-user(13): (lock-tables :read "aaa" 
                          :write '("bigtab" ("ccc" :as "c")) 
                          :showsql t)
sql: "lock tables  aaa read ,  bigtab write ,  ccc as c write"
nil
cl-user(14): 
</pre>

<p id="12">
If the code that uses the tables while they are locked uses
a table alias then you must lock the tables under that alias
or MySQL will complain. So if you have this code:
</p>
<pre id="13">
(sql "select f.item, b.item  from foo f, bar b")
</pre>

<p id="14">
then you must have locked the table "foo" under the alias "f" and
the table "bar" under the alias "b".  You may end up specifying
that the same table be locked multiple times under different
aliases and under no alias:
</p>
<pre id="15">
(lock-tables :read '("foo" ("foo" :as "f") ("foo" :as "ff")))
</pre>

<p id="16">
After locking tables you'll likely want to use the <a href="with-locked-tables.htm"><b>with-locked-tables</b></a> around the code that
processes the locked tables. This ensures that the locks get released
when control leaves the <a href="with-locked-tables.htm"><b>with-locked-tables</b></a> body.
</p>
<p id="17">
See <a href="../../mysql.htm">mysql.htm</a> for information on the Allegro MySQL
facility.
</p>

<hr><p id="18"><small>Copyright (c) 1998-2010, Franz Inc. Oakland, CA., USA. All rights reserved.</small><br><small>Documentation for Allegro CL version 8.2. This page was not revised from the 8.1 page.</small><br>
<small>Created 2010.1.21.</small>
<br></p><table border="0" width="100%" cellpadding="1" cellspacing="0"><tr><td colspan="2" bgcolor="#00FFFF"><table border="0" cellpadding="5" cellspacing="3"><tr><td align="left" bgcolor="#00FFFF"></td><td align="left" bgcolor="#00FFFF"></td><td align="center" bgcolor="#00FFFF"><a href="../../contents.htm"><b>ToC</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../introduction.htm"><b>DocOverview</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../cgide.htm"><b>CGDoc</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../release-notes.htm"><b>RelNotes</b></a></td><td align="center" bgcolor="#00FFFF"><a href="http://www.franz.com/support/faqs/"><b>FAQ</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../index.htm"><b>Index</b></a></td><td align="center" bgcolor="#00FFFF"><a href="../../permuted-index.htm"><b>PermutedIndex</b></a></td></tr></table></td><td align="right"><b>Allegro CL version 8.2</b><br><small><a href="../../introduction.htm#updates-s">Unrevised from 8.1 to 8.2.</a></small><br><a href="http://www.franz.com/support/documentation/8.1/doc/operators/mysql/lock-tables.htm">8.1 version</a></td></tr></table></body></html>